<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>북샵 - 당신의 책을 만나보세요</title>

  <!-- Tailwind CSS: 클래스 이름만으로 스타일링할 수 있게 해주는 CSS 프레임워크 -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Tailwind 커스텀 설정: 우리만의 색상과 폰트를 정의 -->
  <script>
    tailwind.config = {
      theme: {
        extend: {
          /* 쇼핑몰에서 사용할 커스텀 색상 팔레트 */
          colors: {
            primary: '#2563eb',    /* 메인 파란색 - 버튼, 강조에 사용 */
            secondary: '#f59e0b',  /* 보조 노란색 - 별점, 포인트에 사용 */
            accent: '#10b981',     /* 초록색 - 성공, 할인 표시에 사용 */
          }
        }
      }
    }
  </script>

  <!-- React: 화면을 컴포넌트 단위로 만들 수 있게 해주는 라이브러리 -->
  <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>

  <!-- Babel: JSX 문법(HTML처럼 생긴 JavaScript)을 브라우저가 이해할 수 있게 변환 -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <style>
    /* 부드러운 스크롤 효과 */
    html { scroll-behavior: smooth; }

    /* 장바구니 슬라이드 애니메이션 */
    .cart-slide-in {
      animation: slideIn 0.3s ease-out;
    }
    @keyframes slideIn {
      from { transform: translateX(100%); } /* 오른쪽 바깥에서 */
      to { transform: translateX(0); }       /* 제자리로 슬라이드 */
    }

    /* 책 카드 호버 시 살짝 위로 올라가는 효과 */
    .book-card:hover {
      transform: translateY(-4px);
    }
  </style>
</head>

<body>
  <!-- React가 이 안에 모든 화면을 그려줄 거예요 (도화지 같은 역할) -->
  <div id="root"></div>

  <!-- type="text/babel"로 설정하면 Babel이 JSX를 변환해줘요 -->
  <script type="text/babel">
    // ============================================
    // 📚 1단계: 데이터 준비 (책 정보들)
    // ============================================
    // 실제로는 서버에서 가져오지만, 여기서는 미리 준비해둘게요
    const BOOKS = [
      {
        id: 1,
        title: "모던 자바스크립트 Deep Dive",
        author: "이웅모",
        price: 45000,
        originalPrice: 45000,
        image: "https://picsum.photos/seed/js-deep/300/400",
        category: "프로그래밍",
        rating: 4.8,
        description: "자바스크립트의 기본 개념과 동작 원리를 깊이 있게 설명하는 책입니다.",
        badge: "베스트셀러"
      },
      {
        id: 2,
        title: "클린 코드",
        author: "로버트 C. 마틴",
        price: 29700,
        originalPrice: 33000,
        image: "https://picsum.photos/seed/clean-code/300/400",
        category: "프로그래밍",
        rating: 4.6,
        description: "깨끗한 코드를 작성하는 방법을 배울 수 있는 명저입니다.",
        badge: "10% 할인"
      },
      {
        id: 3,
        title: "데미안",
        author: "헤르만 헤세",
        price: 8100,
        originalPrice: 9000,
        image: "https://picsum.photos/seed/demian/300/400",
        category: "소설",
        rating: 4.5,
        description: "자아를 찾아가는 청춘의 이야기를 담은 고전 소설입니다.",
        badge: "10% 할인"
      },
      {
        id: 4,
        title: "사피엔스",
        author: "유발 하라리",
        price: 19800,
        originalPrice: 22000,
        image: "https://picsum.photos/seed/sapiens/300/400",
        category: "교양",
        rating: 4.7,
        description: "인류의 역사를 거시적 관점에서 바라보는 교양 필독서입니다.",
        badge: "10% 할인"
      },
      {
        id: 5,
        title: "리액트를 다루는 기술",
        author: "김민준",
        price: 39600,
        originalPrice: 44000,
        image: "https://picsum.photos/seed/react-book/300/400",
        category: "프로그래밍",
        rating: 4.4,
        description: "React의 기초부터 실전 프로젝트까지 다루는 입문서입니다.",
        badge: "10% 할인"
      },
      {
        id: 6,
        title: "아몬드",
        author: "손원평",
        price: 10800,
        originalPrice: 12000,
        image: "https://picsum.photos/seed/almond/300/400",
        category: "소설",
        rating: 4.3,
        description: "감정을 느끼지 못하는 소년의 성장 이야기입니다.",
        badge: "10% 할인"
      },
      {
        id: 7,
        title: "트렌드 코리아 2026",
        author: "김난도",
        price: 17100,
        originalPrice: 19000,
        image: "https://picsum.photos/seed/trend2026/300/400",
        category: "경제/경영",
        rating: 4.2,
        description: "2026년 대한민국 소비 트렌드를 예측하는 책입니다.",
        badge: "10% 할인"
      },
      {
        id: 8,
        title: "역행자",
        author: "자청",
        price: 15750,
        originalPrice: 17500,
        image: "https://picsum.photos/seed/reverse/300/400",
        category: "자기계발",
        rating: 4.1,
        description: "운명을 거스르는 사람들의 비밀을 담은 자기계발서입니다.",
        badge: "10% 할인"
      },
      {
        id: 9,
        title: "파이썬 알고리즘 인터뷰",
        author: "박상길",
        price: 34200,
        originalPrice: 38000,
        image: "https://picsum.photos/seed/python-algo/300/400",
        category: "프로그래밍",
        rating: 4.5,
        description: "코딩 테스트와 알고리즘 인터뷰를 준비하는 실전 가이드입니다.",
        badge: "10% 할인"
      },
      {
        id: 10,
        title: "돈의 심리학",
        author: "모건 하우절",
        price: 16200,
        originalPrice: 18000,
        image: "https://picsum.photos/seed/money-psy/300/400",
        category: "경제/경영",
        rating: 4.6,
        description: "돈에 대한 심리와 현명한 투자 마인드를 알려주는 책입니다.",
        badge: "10% 할인"
      },
      {
        id: 11,
        title: "미움받을 용기",
        author: "기시미 이치로",
        price: 14400,
        originalPrice: 16000,
        image: "https://picsum.photos/seed/courage/300/400",
        category: "자기계발",
        rating: 4.7,
        description: "아들러 심리학을 쉽게 풀어낸 대화형 자기계발서입니다.",
        badge: "10% 할인"
      },
      {
        id: 12,
        title: "작별인사",
        author: "김영하",
        price: 13500,
        originalPrice: 15000,
        image: "https://picsum.photos/seed/goodbye/300/400",
        category: "소설",
        rating: 4.4,
        description: "가까운 미래를 배경으로 한 김영하 작가의 장편소설입니다.",
        badge: "10% 할인"
      }
    ];

    // 카테고리 목록 (필터링에 사용)
    const CATEGORIES = ["전체", "프로그래밍", "소설", "교양", "경제/경영", "자기계발"];

    // ============================================
    // 📚 2단계: 가격 포맷 함수
    // ============================================
    // 숫자를 "45,000원" 같은 형식으로 바꿔주는 함수
    function formatPrice(price) {
      return price.toLocaleString("ko-KR") + "원";
    }

    // ============================================
    // ⭐ 3단계: 별점 컴포넌트
    // ============================================
    // rating(예: 4.5)을 받아서 별 아이콘으로 표시해주는 컴포넌트
    function StarRating({ rating }) {
      return (
        <div className="flex items-center gap-1">
          {/* 별 5개를 순서대로 그려요 */}
          {[1, 2, 3, 4, 5].map((star) => (
            <svg
              key={star}
              className={`w-4 h-4 ${
                /* 현재 별 번호가 rating 이하면 노란색, 아니면 회색 */
                star <= Math.round(rating) ? "text-secondary" : "text-gray-300"
              }`}
              fill="currentColor"
              viewBox="0 0 20 20"
            >
              <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z" />
            </svg>
          ))}
          {/* 숫자로도 별점을 표시 */}
          <span className="text-sm text-gray-500 ml-1">{rating}</span>
        </div>
      );
    }

    // ============================================
    // 🃏 4단계: 책 카드 컴포넌트
    // ============================================
    // 각 책 하나를 카드 형태로 보여주는 컴포넌트
    function BookCard({ book, onAddToCart }) {
      // 할인율 계산: (원래가격 - 현재가격) / 원래가격 * 100
      const discount = book.originalPrice > book.price
        ? Math.round((1 - book.price / book.originalPrice) * 100)
        : 0;

      return (
        <div className="book-card bg-white rounded-xl shadow-md overflow-hidden transition-all duration-300 hover:shadow-xl flex flex-col">
          {/*
            책 표지 이미지 영역
            relative: 배지를 이미지 위에 겹쳐놓기 위해 사용
          */}
          <div className="relative">
            <img
              src={book.image}
              alt={book.title}
              className="w-full h-64 object-cover"
              /* w-full: 너비를 부모만큼 꽉 채움 */
              /* h-64: 높이 256px 고정 */
              /* object-cover: 비율 유지하면서 영역을 꽉 채움 (잘릴 수 있음) */
            />
            {/* 배지 (베스트셀러, 할인 등) - badge가 있을 때만 표시 */}
            {book.badge && (
              <span className="absolute top-2 left-2 bg-red-500 text-white text-xs font-bold px-2 py-1 rounded-full">
                {/* absolute: 부모(relative) 기준으로 위치 지정 */}
                {/* top-2 left-2: 왼쪽 위 모서리에서 약간 떨어진 위치 */}
                {book.badge}
              </span>
            )}
          </div>

          {/* 책 정보 영역 */}
          <div className="p-4 flex flex-col flex-grow">
            {/* p-4: 안쪽 여백 16px (상자 안의 내용물과 테두리 사이 간격) */}
            {/* flex-grow: 남는 공간을 이 영역이 차지하게 함 */}

            {/* 카테고리 라벨 */}
            <span className="text-xs text-primary font-semibold uppercase tracking-wide">
              {book.category}
            </span>

            {/* 책 제목 */}
            <h3 className="mt-1 text-lg font-bold text-gray-900 line-clamp-2">
              {/* line-clamp-2: 2줄까지만 보여주고 나머지는 ... 처리 */}
              {book.title}
            </h3>

            {/* 저자 */}
            <p className="text-sm text-gray-500 mt-1">{book.author}</p>

            {/* 별점 */}
            <div className="mt-2">
              <StarRating rating={book.rating} />
            </div>

            {/* 가격 + 장바구니 버튼 영역 (카드 하단에 고정) */}
            <div className="mt-auto pt-4">
              {/* mt-auto: 위쪽 여백을 자동으로 최대한 넓혀서 아래로 밀어냄 */}
              <div className="flex items-end justify-between">
                <div>
                  {/* 할인이 있으면 원래 가격을 취소선으로 표시 */}
                  {discount > 0 && (
                    <p className="text-xs text-gray-400 line-through">
                      {formatPrice(book.originalPrice)}
                    </p>
                  )}
                  <p className="text-xl font-bold text-gray-900">
                    {/* 할인율 표시 */}
                    {discount > 0 && (
                      <span className="text-red-500 mr-1">{discount}%</span>
                    )}
                    {formatPrice(book.price)}
                  </p>
                </div>

                {/* 장바구니 담기 버튼 */}
                <button
                  onClick={() => onAddToCart(book)}
                  className="bg-primary hover:bg-blue-700 text-white p-2 rounded-lg transition-colors duration-200"
                  /* hover:bg-blue-700: 마우스를 올리면 더 진한 파란색으로 변경 */
                  /* transition-colors: 색상이 부드럽게 변하는 효과 */
                >
                  {/* 장바구니 아이콘 (SVG) */}
                  <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 100 4 2 2 0 000-4z" />
                  </svg>
                </button>
              </div>
            </div>
          </div>
        </div>
      );
    }

    // ============================================
    // 🛒 5단계: 장바구니 패널 컴포넌트
    // ============================================
    // 오른쪽에서 슬라이드로 열리는 장바구니 화면
    function CartPanel({ cart, onClose, onUpdateQuantity, onRemove }) {
      // 총 금액 계산: 각 상품의 (가격 × 수량)을 모두 더함
      const totalPrice = cart.reduce(
        (sum, item) => sum + item.price * item.quantity,
        0  /* 초기값 0부터 시작 */
      );

      // 총 수량 계산
      const totalItems = cart.reduce((sum, item) => sum + item.quantity, 0);

      return (
        /* 장바구니 배경 오버레이 (반투명 검정) */
        <div
          className="fixed inset-0 z-50 flex justify-end"
          /* fixed: 스크롤해도 화면에 고정 */
          /* inset-0: 상하좌우 모두 0 → 화면 전체를 덮음 */
          /* z-50: 다른 요소보다 위에 표시 (레이어 순서) */
          /* justify-end: 오른쪽 끝에 정렬 */
        >
          {/* 클릭하면 장바구니 닫히는 반투명 배경 */}
          <div
            className="absolute inset-0 bg-black bg-opacity-50"
            onClick={onClose}
          />

          {/* 장바구니 패널 본체 */}
          <div className="cart-slide-in relative w-full max-w-md bg-white shadow-2xl flex flex-col">
            {/* max-w-md: 최대 너비 448px (너무 넓어지지 않게) */}

            {/* 장바구니 헤더 */}
            <div className="flex items-center justify-between p-6 border-b">
              <h2 className="text-xl font-bold text-gray-900">
                장바구니 ({totalItems})
              </h2>
              {/* 닫기(X) 버튼 */}
              <button
                onClick={onClose}
                className="text-gray-400 hover:text-gray-600 transition-colors"
              >
                <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12" />
                </svg>
              </button>
            </div>

            {/* 장바구니 상품 목록 (스크롤 가능) */}
            <div className="flex-1 overflow-y-auto p-6">
              {/* flex-1: 남는 공간을 모두 차지 */}
              {/* overflow-y-auto: 내용이 넘치면 세로 스크롤 생성 */}

              {cart.length === 0 ? (
                /* 장바구니가 비어있을 때 */
                <div className="text-center py-16">
                  <svg className="w-16 h-16 mx-auto text-gray-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={1.5} d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 100 4 2 2 0 000-4z" />
                  </svg>
                  <p className="mt-4 text-gray-500">장바구니가 비어있습니다</p>
                </div>
              ) : (
                /* 장바구니에 상품이 있을 때 */
                <div className="space-y-4">
                  {/* space-y-4: 자식 요소들 사이에 16px 간격 */}
                  {cart.map((item) => (
                    <div key={item.id} className="flex gap-4 bg-gray-50 rounded-lg p-3">
                      {/* 작은 책 표지 이미지 */}
                      <img
                        src={item.image}
                        alt={item.title}
                        className="w-16 h-20 object-cover rounded"
                      />
                      <div className="flex-1 min-w-0">
                        {/* min-w-0: 텍스트가 넘칠 때 줄임(...) 처리 가능하게 */}
                        <h4 className="font-semibold text-sm text-gray-900 truncate">
                          {item.title}
                        </h4>
                        <p className="text-xs text-gray-500">{item.author}</p>
                        <p className="text-sm font-bold text-primary mt-1">
                          {formatPrice(item.price)}
                        </p>

                        {/* 수량 조절 버튼 */}
                        <div className="flex items-center gap-2 mt-2">
                          {/* 수량 감소 버튼 */}
                          <button
                            onClick={() => onUpdateQuantity(item.id, item.quantity - 1)}
                            className="w-6 h-6 rounded bg-gray-200 hover:bg-gray-300 flex items-center justify-center text-sm font-bold transition-colors"
                          >
                            −
                          </button>
                          {/* 현재 수량 */}
                          <span className="text-sm font-semibold w-6 text-center">
                            {item.quantity}
                          </span>
                          {/* 수량 증가 버튼 */}
                          <button
                            onClick={() => onUpdateQuantity(item.id, item.quantity + 1)}
                            className="w-6 h-6 rounded bg-gray-200 hover:bg-gray-300 flex items-center justify-center text-sm font-bold transition-colors"
                          >
                            +
                          </button>
                          {/* 삭제 버튼 */}
                          <button
                            onClick={() => onRemove(item.id)}
                            className="ml-auto text-red-400 hover:text-red-600 transition-colors"
                          >
                            <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                            </svg>
                          </button>
                        </div>
                      </div>
                    </div>
                  ))}
                </div>
              )}
            </div>

            {/* 장바구니 하단: 총 금액 + 주문 버튼 */}
            {cart.length > 0 && (
              <div className="border-t p-6 space-y-4">
                {/* 배송비 안내 */}
                <div className="flex justify-between text-sm text-gray-500">
                  <span>배송비</span>
                  <span>{totalPrice >= 30000 ? "무료" : formatPrice(3000)}</span>
                </div>
                {/* 총 결제 금액 */}
                <div className="flex justify-between text-lg font-bold">
                  <span>총 결제금액</span>
                  <span className="text-primary">
                    {formatPrice(totalPrice >= 30000 ? totalPrice : totalPrice + 3000)}
                  </span>
                </div>
                {/* 3만원 이상 무료배송 안내 */}
                {totalPrice < 30000 && (
                  <p className="text-xs text-accent text-center">
                    {formatPrice(30000 - totalPrice)} 더 담으면 무료배송!
                  </p>
                )}
                {/* 주문하기 버튼 */}
                <button className="w-full bg-primary hover:bg-blue-700 text-white font-bold py-3 rounded-xl transition-colors duration-200">
                  주문하기
                </button>
              </div>
            )}
          </div>
        </div>
      );
    }

    // ============================================
    // 📖 6단계: 책 상세 모달 컴포넌트
    // ============================================
    function BookDetail({ book, onClose, onAddToCart }) {
      if (!book) return null;

      const discount = book.originalPrice > book.price
        ? Math.round((1 - book.price / book.originalPrice) * 100)
        : 0;

      return (
        <div className="fixed inset-0 z-50 flex items-center justify-center p-4">
          {/* 배경 오버레이 */}
          <div className="absolute inset-0 bg-black bg-opacity-50" onClick={onClose} />

          {/* 모달 본체 */}
          <div className="relative bg-white rounded-2xl shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto">
            {/* 닫기 버튼 */}
            <button
              onClick={onClose}
              className="absolute top-4 right-4 z-10 bg-white rounded-full p-1 shadow-md text-gray-400 hover:text-gray-600"
            >
              <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12" />
              </svg>
            </button>

            <div className="md:flex">
              {/* 책 표지 */}
              <div className="md:w-1/2">
                <img
                  src={book.image}
                  alt={book.title}
                  className="w-full h-72 md:h-full object-cover rounded-t-2xl md:rounded-l-2xl md:rounded-tr-none"
                />
              </div>
              {/* 책 정보 */}
              <div className="p-6 md:w-1/2 flex flex-col">
                <span className="text-sm text-primary font-semibold">{book.category}</span>
                <h2 className="text-2xl font-bold text-gray-900 mt-1">{book.title}</h2>
                <p className="text-gray-500 mt-1">{book.author}</p>
                <div className="mt-3">
                  <StarRating rating={book.rating} />
                </div>
                <p className="text-gray-600 mt-4 leading-relaxed">{book.description}</p>

                <div className="mt-auto pt-6">
                  <div className="mb-4">
                    {discount > 0 && (
                      <p className="text-sm text-gray-400 line-through">
                        {formatPrice(book.originalPrice)}
                      </p>
                    )}
                    <p className="text-2xl font-bold">
                      {discount > 0 && (
                        <span className="text-red-500 mr-1">{discount}%</span>
                      )}
                      {formatPrice(book.price)}
                    </p>
                  </div>
                  <button
                    onClick={() => { onAddToCart(book); onClose(); }}
                    className="w-full bg-primary hover:bg-blue-700 text-white font-bold py-3 rounded-xl transition-colors duration-200"
                  >
                    장바구니에 담기
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>
      );
    }

    // ============================================
    // 🔑 7단계: 로그인 모달 컴포넌트
    // ============================================
    // 이메일과 비밀번호를 입력받아 서버에 로그인 요청을 보내는 화면
    function LoginModal({ onClose, onSwitchToRegister, onLoginSuccess }) {
      // 입력값과 상태를 관리하는 state들
      const [email, setEmail] = React.useState('');
      const [password, setPassword] = React.useState('');
      const [error, setError] = React.useState('');       // 에러 메시지
      const [loading, setLoading] = React.useState(false); // 로딩 중 여부

      // 폼 제출 시 실행되는 함수
      async function handleSubmit(e) {
        e.preventDefault(); // 페이지 새로고침 방지 (폼의 기본 동작)
        setError('');
        setLoading(true);

        try {
          // 서버의 로그인 API에 요청 보내기
          const res = await fetch('/api/login', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ email, password })
            // JSON.stringify: 자바스크립트 객체를 JSON 문자열로 변환
          });

          const data = await res.json(); // 서버 응답을 JSON으로 변환

          if (res.ok) {
            // 로그인 성공!
            // 토큰을 localStorage에 저장 (브라우저를 닫아도 유지됨)
            localStorage.setItem('token', data.token);
            onLoginSuccess(data.user); // 부모 컴포넌트에 사용자 정보 전달
            onClose(); // 모달 닫기
          } else {
            // 로그인 실패 (이메일/비밀번호 틀림 등)
            setError(data.error);
          }
        } catch (err) {
          setError('서버 연결에 실패했습니다');
        }
        setLoading(false);
      }

      return (
        <div className="fixed inset-0 z-50 flex items-center justify-center p-4">
          {/* 반투명 배경 오버레이 */}
          <div className="absolute inset-0 bg-black bg-opacity-50" onClick={onClose} />

          {/* 모달 본체 */}
          <div className="relative bg-white rounded-2xl shadow-2xl max-w-md w-full p-8">
            {/* 닫기 버튼 */}
            <button onClick={onClose} className="absolute top-4 right-4 text-gray-400 hover:text-gray-600">
              <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12" />
              </svg>
            </button>

            {/* 제목 */}
            <h2 className="text-2xl font-bold text-gray-900 mb-6">로그인</h2>

            {/* 에러 메시지 (있을 때만 표시) */}
            {error && (
              <p className="text-red-500 text-sm mb-4 bg-red-50 p-3 rounded-lg">{error}</p>
            )}

            {/* 로그인 폼 */}
            <form onSubmit={handleSubmit} className="space-y-4">
              {/* space-y-4: 폼 안의 각 입력 필드 사이 간격 16px */}
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-1">이메일</label>
                <input
                  type="email"
                  value={email}
                  onChange={(e) => setEmail(e.target.value)}
                  required
                  placeholder="example@email.com"
                  className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:outline-none"
                />
              </div>
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-1">비밀번호</label>
                <input
                  type="password"
                  value={password}
                  onChange={(e) => setPassword(e.target.value)}
                  required
                  placeholder="비밀번호 입력"
                  className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:outline-none"
                />
              </div>
              <button
                type="submit"
                disabled={loading}
                className="w-full bg-primary hover:bg-blue-700 text-white font-bold py-3 rounded-xl transition-colors disabled:opacity-50"
                /* disabled:opacity-50: 로딩 중일 때 버튼을 반투명하게 */
              >
                {loading ? '로그인 중...' : '로그인'}
              </button>
            </form>

            {/* 회원가입으로 전환 링크 */}
            <p className="text-center text-sm text-gray-500 mt-4">
              계정이 없으신가요?{' '}
              <button onClick={onSwitchToRegister} className="text-primary font-semibold hover:underline">
                회원가입
              </button>
            </p>
          </div>
        </div>
      );
    }

    // ============================================
    // 📝 8단계: 회원가입 모달 컴포넌트
    // ============================================
    // 이름, 이메일, 비밀번호를 입력받아 서버에 가입 요청을 보내는 화면
    function RegisterModal({ onClose, onSwitchToLogin }) {
      const [email, setEmail] = React.useState('');
      const [password, setPassword] = React.useState('');
      const [error, setError] = React.useState('');
      const [loading, setLoading] = React.useState(false);

      async function handleSubmit(e) {
        e.preventDefault();
        setError('');

        // 비밀번호 길이 확인 (서버에서도 검증하지만, 미리 확인하면 더 빠른 피드백)
        if (password.length < 6) {
          setError('비밀번호는 6자 이상이어야 합니다');
          return;
        }

        setLoading(true);

        try {
          const res = await fetch('/api/register', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ email, password })
          });

          const data = await res.json();

          if (res.ok) {
            // 회원가입 성공 → 로그인 모달로 전환
            onSwitchToLogin();
          } else {
            setError(data.error);
          }
        } catch (err) {
          setError('서버 연결에 실패했습니다');
        }
        setLoading(false);
      }

      return (
        <div className="fixed inset-0 z-50 flex items-center justify-center p-4">
          <div className="absolute inset-0 bg-black bg-opacity-50" onClick={onClose} />

          <div className="relative bg-white rounded-2xl shadow-2xl max-w-md w-full p-8">
            <button onClick={onClose} className="absolute top-4 right-4 text-gray-400 hover:text-gray-600">
              <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12" />
              </svg>
            </button>

            <h2 className="text-2xl font-bold text-gray-900 mb-6">회원가입</h2>

            {error && (
              <p className="text-red-500 text-sm mb-4 bg-red-50 p-3 rounded-lg">{error}</p>
            )}

            <form onSubmit={handleSubmit} className="space-y-4">
              {/* 이메일 입력 */}
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-1">이메일</label>
                <input
                  type="email"
                  value={email}
                  onChange={(e) => setEmail(e.target.value)}
                  required
                  placeholder="example@email.com"
                  className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:outline-none"
                />
              </div>
              {/* 비밀번호 입력 */}
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-1">비밀번호</label>
                <input
                  type="password"
                  value={password}
                  onChange={(e) => setPassword(e.target.value)}
                  required
                  placeholder="6자 이상 입력"
                  className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:outline-none"
                />
              </div>
              <button
                type="submit"
                disabled={loading}
                className="w-full bg-primary hover:bg-blue-700 text-white font-bold py-3 rounded-xl transition-colors disabled:opacity-50"
              >
                {loading ? '가입 중...' : '회원가입'}
              </button>
            </form>

            {/* 로그인으로 전환 링크 */}
            <p className="text-center text-sm text-gray-500 mt-4">
              이미 계정이 있으신가요?{' '}
              <button onClick={onSwitchToLogin} className="text-primary font-semibold hover:underline">
                로그인
              </button>
            </p>
          </div>
        </div>
      );
    }

    // ============================================
    // 🏠 9단계: 메인 App 컴포넌트
    // ============================================
    // 모든 것을 하나로 합치는 최상위 컴포넌트
    function App() {
      // --- React 상태(state) 관리 ---
      // state = 컴포넌트가 기억하는 데이터. 값이 바뀌면 화면이 자동으로 다시 그려져요.

      const [cart, setCart] = React.useState([]);
      // cart: 장바구니에 담긴 책 목록 (배열)
      // setCart: cart 값을 바꾸는 함수

      const [isCartOpen, setIsCartOpen] = React.useState(false);
      // isCartOpen: 장바구니 패널이 열려있는지 (true/false)

      const [selectedCategory, setSelectedCategory] = React.useState("전체");
      // selectedCategory: 현재 선택된 카테고리

      const [searchQuery, setSearchQuery] = React.useState("");
      // searchQuery: 검색창에 입력된 텍스트

      const [selectedBook, setSelectedBook] = React.useState(null);
      // selectedBook: 상세보기로 선택된 책 (없으면 null)

      const [toast, setToast] = React.useState(null);
      // toast: 알림 메시지 (예: "장바구니에 담았습니다")

      // === 인증(로그인) 관련 상태 ===
      const [user, setUser] = React.useState(null);
      // user: 로그인된 사용자 정보 (null이면 비로그인 상태)

      const [showLogin, setShowLogin] = React.useState(false);
      // showLogin: 로그인 모달을 보여줄지 여부

      const [showRegister, setShowRegister] = React.useState(false);
      // showRegister: 회원가입 모달을 보여줄지 여부

      // === 페이지 로드 시 자동 로그인 확인 ===
      // useEffect: 컴포넌트가 처음 화면에 나타날 때 한 번 실행되는 함수
      // (빈 배열 []을 넣으면 "처음 한 번만" 실행)
      React.useEffect(() => {
        const token = localStorage.getItem('token');
        if (token) {
          // 토큰이 있으면 → 서버에 "이 토큰 아직 유효해?" 확인
          fetch('/api/me', {
            headers: { 'Authorization': 'Bearer ' + token }
          })
          .then(res => res.json())
          .then(data => {
            if (data.user) {
              setUser(data.user); // 유효하면 → 로그인 상태로 설정
            } else {
              localStorage.removeItem('token'); // 무효하면 → 토큰 삭제
            }
          })
          .catch(() => localStorage.removeItem('token'));
        }
      }, []);

      // === 로그아웃 함수 ===
      function handleLogout() {
        localStorage.removeItem('token'); // 저장된 토큰 삭제
        setUser(null);                     // 사용자 정보 초기화
        showToast('로그아웃 되었습니다');
      }

      // --- 책 필터링 로직 ---
      // 카테고리와 검색어에 맞는 책만 골라내기
      const filteredBooks = BOOKS.filter((book) => {
        // 1. 카테고리 필터: "전체"이면 통과, 아니면 같은 카테고리만
        const matchesCategory =
          selectedCategory === "전체" || book.category === selectedCategory;

        // 2. 검색 필터: 제목이나 저자에 검색어가 포함되어 있는지 확인
        const matchesSearch =
          book.title.toLowerCase().includes(searchQuery.toLowerCase()) ||
          book.author.toLowerCase().includes(searchQuery.toLowerCase());

        // 둘 다 만족해야 표시
        return matchesCategory && matchesSearch;
      });

      // --- 장바구니 담기 함수 ---
      function addToCart(book) {
        setCart((prevCart) => {
          // 이미 장바구니에 같은 책이 있는지 확인
          const existingItem = prevCart.find((item) => item.id === book.id);

          if (existingItem) {
            // 이미 있으면 → 수량만 1 증가
            return prevCart.map((item) =>
              item.id === book.id
                ? { ...item, quantity: item.quantity + 1 }
                : item
            );
          } else {
            // 없으면 → 새로 추가 (수량 1로 시작)
            return [...prevCart, { ...book, quantity: 1 }];
          }
        });

        // 토스트 알림 표시
        showToast(`"${book.title}" 을(를) 장바구니에 담았습니다!`);
      }

      // --- 수량 변경 함수 ---
      function updateQuantity(bookId, newQuantity) {
        if (newQuantity <= 0) {
          // 수량이 0 이하면 → 장바구니에서 제거
          removeFromCart(bookId);
          return;
        }
        setCart((prevCart) =>
          prevCart.map((item) =>
            item.id === bookId ? { ...item, quantity: newQuantity } : item
          )
        );
      }

      // --- 장바구니에서 제거 함수 ---
      function removeFromCart(bookId) {
        setCart((prevCart) => prevCart.filter((item) => item.id !== bookId));
      }

      // --- 토스트 알림 표시 함수 ---
      function showToast(message) {
        setToast(message);
        // 2초 후 자동으로 사라짐
        setTimeout(() => setToast(null), 2000);
      }

      // 장바구니 총 수량 (헤더 뱃지에 표시)
      const cartItemCount = cart.reduce((sum, item) => sum + item.quantity, 0);

      // --- 화면 렌더링 ---
      return (
        <div className="min-h-screen bg-gray-50">
          {/* min-h-screen: 최소 높이를 화면 전체로 (내용이 적어도 배경이 꽉 참) */}
          {/* bg-gray-50: 아주 연한 회색 배경 */}

          {/* ========== 헤더 (상단 네비게이션 바) ========== */}
          <header className="bg-white shadow-sm sticky top-0 z-40">
            {/* sticky top-0: 스크롤해도 화면 상단에 붙어있음 */}
            {/* z-40: 다른 콘텐츠보다 위에 표시 */}
            <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
              {/* max-w-7xl: 최대 너비 제한 (너무 넓은 화면에서 가운데 정렬) */}
              {/* mx-auto: 좌우 마진 자동 → 가운데 정렬 */}
              <div className="flex items-center justify-between h-16">

                {/* 로고 */}
                <div className="flex items-center gap-2">
                  <svg className="w-8 h-8 text-primary" fill="currentColor" viewBox="0 0 24 24">
                    <path d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253" />
                  </svg>
                  <h1 className="text-xl font-bold text-gray-900">
                    북<span className="text-primary">샵</span>
                  </h1>
                </div>

                {/* 검색바 */}
                <div className="flex-1 max-w-lg mx-8 hidden sm:block">
                  {/* hidden sm:block: 작은 화면에서는 숨기고, sm(640px) 이상에서 표시 */}
                  <div className="relative">
                    {/* 돋보기 아이콘 */}
                    <svg className="absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                    </svg>
                    {/* 검색 입력창 */}
                    <input
                      type="text"
                      placeholder="책 제목, 저자로 검색..."
                      value={searchQuery}
                      onChange={(e) => setSearchQuery(e.target.value)}
                      className="w-full pl-10 pr-4 py-2 rounded-full border border-gray-300 focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent bg-gray-50"
                      /* pl-10: 왼쪽 안쪽 여백 40px (돋보기 아이콘 공간 확보) */
                      /* rounded-full: 완전한 둥근 모서리 (알약 모양) */
                      /* focus:ring-2: 클릭(포커스)하면 파란색 테두리 강조 */
                    />
                  </div>
                </div>

                {/* ===== 로그인/사용자 정보 + 장바구니 영역 ===== */}
                <div className="flex items-center gap-3">
                  {user ? (
                    /* 로그인 되었을 때: 사용자 이름 + 로그아웃 버튼 */
                    <div className="flex items-center gap-2">
                      {/* 사용자 아이콘 */}
                      <svg className="w-5 h-5 text-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
                      </svg>
                      <span className="text-sm font-medium text-gray-700 hidden sm:block">
                        {user.email}님
                      </span>
                      <button
                        onClick={handleLogout}
                        className="text-sm text-gray-500 hover:text-gray-700 transition-colors"
                      >
                        로그아웃
                      </button>
                    </div>
                  ) : (
                    /* 로그인 안 되었을 때: 로그인/회원가입 버튼 */
                    <div className="flex items-center gap-2">
                      <button
                        onClick={() => setShowLogin(true)}
                        className="text-sm font-medium text-gray-600 hover:text-primary transition-colors"
                      >
                        로그인
                      </button>
                      <button
                        onClick={() => setShowRegister(true)}
                        className="text-sm bg-primary text-white px-3 py-1.5 rounded-lg hover:bg-blue-700 transition-colors"
                      >
                        회원가입
                      </button>
                    </div>
                  )}

                  {/* 장바구니 버튼 */}
                  <button
                    onClick={() => setIsCartOpen(true)}
                    className="relative p-2 text-gray-600 hover:text-primary transition-colors"
                  >
                    <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 100 4 2 2 0 000-4z" />
                    </svg>
                    {cartItemCount > 0 && (
                      <span className="absolute -top-1 -right-1 bg-red-500 text-white text-xs font-bold w-5 h-5 rounded-full flex items-center justify-center">
                        {cartItemCount}
                      </span>
                    )}
                  </button>
                </div>
              </div>

              {/* 모바일용 검색바 (작은 화면에서만 표시) */}
              <div className="sm:hidden pb-3">
                <div className="relative">
                  <svg className="absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                  </svg>
                  <input
                    type="text"
                    placeholder="책 제목, 저자로 검색..."
                    value={searchQuery}
                    onChange={(e) => setSearchQuery(e.target.value)}
                    className="w-full pl-10 pr-4 py-2 rounded-full border border-gray-300 focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent bg-gray-50"
                  />
                </div>
              </div>
            </div>
          </header>

          {/* ========== 히어로 배너 (메인 이미지 영역) ========== */}
          <section className="bg-gradient-to-r from-blue-600 to-indigo-700 text-white">
            {/* bg-gradient-to-r: 왼쪽→오른쪽으로 그라데이션 배경 */}
            <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12 sm:py-16">
              <div className="text-center">
                <h2 className="text-3xl sm:text-4xl font-extrabold">
                  당신의 다음 책을 만나보세요
                </h2>
                <p className="mt-4 text-lg text-blue-100 max-w-2xl mx-auto">
                  베스트셀러부터 숨겨진 명작까지, 다양한 책을 만나볼 수 있는 곳
                </p>
                <div className="mt-6 flex justify-center gap-4">
                  <span className="bg-white bg-opacity-20 px-4 py-2 rounded-full text-sm">
                    3만원 이상 무료배송
                  </span>
                  <span className="bg-white bg-opacity-20 px-4 py-2 rounded-full text-sm">
                    최대 10% 할인
                  </span>
                </div>
              </div>
            </div>
          </section>

          {/* ========== 메인 콘텐츠 영역 ========== */}
          <main className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">

            {/* 카테고리 필터 버튼들 */}
            <div className="flex flex-wrap gap-2 mb-8">
              {/* flex-wrap: 버튼이 많으면 자동으로 다음 줄로 */}
              {/* gap-2: 버튼 사이 간격 8px */}
              {CATEGORIES.map((category) => (
                <button
                  key={category}
                  onClick={() => setSelectedCategory(category)}
                  className={`px-4 py-2 rounded-full text-sm font-medium transition-colors duration-200 ${
                    /* 선택된 카테고리는 파란색 배경, 나머지는 회색 배경 */
                    selectedCategory === category
                      ? "bg-primary text-white"
                      : "bg-white text-gray-600 hover:bg-gray-100 border border-gray-300"
                  }`}
                >
                  {category}
                </button>
              ))}
            </div>

            {/* 검색 결과 개수 */}
            <p className="text-sm text-gray-500 mb-4">
              {filteredBooks.length}권의 책이 있습니다
            </p>

            {/* 책 카드 그리드 (격자 배열) */}
            {filteredBooks.length > 0 ? (
              <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
                {/*
                  grid: 격자 레이아웃
                  grid-cols-1: 기본(모바일) 1열
                  sm:grid-cols-2: 640px 이상에서 2열
                  lg:grid-cols-3: 1024px 이상에서 3열
                  xl:grid-cols-4: 1280px 이상에서 4열
                  gap-6: 카드 사이 간격 24px
                */}
                {filteredBooks.map((book) => (
                  <div key={book.id} onClick={() => setSelectedBook(book)} className="cursor-pointer">
                    <BookCard book={book} onAddToCart={addToCart} />
                  </div>
                ))}
              </div>
            ) : (
              /* 검색 결과가 없을 때 */
              <div className="text-center py-16">
                <svg className="w-16 h-16 mx-auto text-gray-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={1.5} d="M9.172 16.172a4 4 0 015.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                </svg>
                <p className="mt-4 text-gray-500 text-lg">검색 결과가 없습니다</p>
                <p className="text-gray-400 text-sm mt-1">다른 검색어를 입력해보세요</p>
              </div>
            )}
          </main>

          {/* ========== 푸터 ========== */}
          <footer className="bg-gray-900 text-gray-400 mt-16">
            <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
              <div className="grid grid-cols-1 md:grid-cols-3 gap-8">
                {/* 회사 정보 */}
                <div>
                  <h3 className="text-white font-bold text-lg mb-4">
                    북<span className="text-primary">샵</span>
                  </h3>
                  <p className="text-sm leading-relaxed">
                    좋은 책과 독자를 연결하는 온라인 서점입니다.
                    다양한 분야의 책을 합리적인 가격에 만나보세요.
                  </p>
                </div>
                {/* 고객 서비스 */}
                <div>
                  <h3 className="text-white font-bold mb-4">고객 서비스</h3>
                  <ul className="space-y-2 text-sm">
                    <li><a href="#" className="hover:text-white transition-colors">자주 묻는 질문</a></li>
                    <li><a href="#" className="hover:text-white transition-colors">배송 안내</a></li>
                    <li><a href="#" className="hover:text-white transition-colors">반품/교환</a></li>
                    <li><a href="#" className="hover:text-white transition-colors">1:1 문의</a></li>
                  </ul>
                </div>
                {/* 연락처 */}
                <div>
                  <h3 className="text-white font-bold mb-4">연락처</h3>
                  <ul className="space-y-2 text-sm">
                    <li>전화: 1234-5678</li>
                    <li>이메일: help@bookshop.kr</li>
                    <li>운영시간: 평일 09:00 - 18:00</li>
                  </ul>
                </div>
              </div>
              {/* 저작권 표시 */}
              <div className="border-t border-gray-800 mt-8 pt-8 text-center text-sm">
                © 2026 북샵. All rights reserved.
              </div>
            </div>
          </footer>

          {/* ========== 장바구니 패널 (열려있을 때만 표시) ========== */}
          {isCartOpen && (
            <CartPanel
              cart={cart}
              onClose={() => setIsCartOpen(false)}
              onUpdateQuantity={updateQuantity}
              onRemove={removeFromCart}
            />
          )}

          {/* ========== 책 상세 모달 (책을 클릭했을 때만 표시) ========== */}
          {selectedBook && (
            <BookDetail
              book={selectedBook}
              onClose={() => setSelectedBook(null)}
              onAddToCart={addToCart}
            />
          )}

          {/* ========== 로그인 모달 ========== */}
          {showLogin && (
            <LoginModal
              onClose={() => setShowLogin(false)}
              onSwitchToRegister={() => {
                setShowLogin(false);    // 로그인 모달 닫고
                setShowRegister(true);  // 회원가입 모달 열기
              }}
              onLoginSuccess={(userData) => {
                setUser(userData);                          // 사용자 정보 저장
                showToast(userData.email + '님 환영합니다!'); // 환영 메시지
              }}
            />
          )}

          {/* ========== 회원가입 모달 ========== */}
          {showRegister && (
            <RegisterModal
              onClose={() => setShowRegister(false)}
              onSwitchToLogin={() => {
                setShowRegister(false); // 회원가입 모달 닫고
                setShowLogin(true);     // 로그인 모달 열기
                showToast('회원가입이 완료되었습니다! 로그인해주세요.');
              }}
            />
          )}

          {/* ========== 토스트 알림 (장바구니 담기 시 표시) ========== */}
          {toast && (
            <div className="fixed bottom-6 left-1/2 -translate-x-1/2 z-50 bg-gray-800 text-white px-6 py-3 rounded-full shadow-lg text-sm font-medium animate-bounce">
              {/* fixed bottom-6: 화면 하단에 고정 */}
              {/* left-1/2 -translate-x-1/2: 정확한 가운데 정렬 */}
              {toast}
            </div>
          )}
        </div>
      );
    }

    // ============================================
    // 🚀 8단계: React 앱 시작!
    // ============================================
    // React 18의 새로운 방식으로 앱을 화면에 렌더링(그리기)합니다
    const root = ReactDOM.createRoot(document.getElementById("root"));
    root.render(<App />);
  </script>
</body>
</html>

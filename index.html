<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ë¶ìƒµ - ë‹¹ì‹ ì˜ ì±…ì„ ë§Œë‚˜ë³´ì„¸ìš”</title>

  <!-- Tailwind CSS: í´ë˜ìŠ¤ ì´ë¦„ë§Œìœ¼ë¡œ ìŠ¤íƒ€ì¼ë§í•  ìˆ˜ ìˆê²Œ í•´ì£¼ëŠ” CSS í”„ë ˆì„ì›Œí¬ -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Tailwind ì»¤ìŠ¤í…€ ì„¤ì •: ìš°ë¦¬ë§Œì˜ ìƒ‰ìƒê³¼ í°íŠ¸ë¥¼ ì •ì˜ -->
  <script>
    tailwind.config = {
      theme: {
        extend: {
          /* ì‡¼í•‘ëª°ì—ì„œ ì‚¬ìš©í•  ì»¤ìŠ¤í…€ ìƒ‰ìƒ íŒ”ë ˆíŠ¸ */
          colors: {
            primary: '#2563eb',    /* ë©”ì¸ íŒŒë€ìƒ‰ - ë²„íŠ¼, ê°•ì¡°ì— ì‚¬ìš© */
            secondary: '#f59e0b',  /* ë³´ì¡° ë…¸ë€ìƒ‰ - ë³„ì , í¬ì¸íŠ¸ì— ì‚¬ìš© */
            accent: '#10b981',     /* ì´ˆë¡ìƒ‰ - ì„±ê³µ, í• ì¸ í‘œì‹œì— ì‚¬ìš© */
          }
        }
      }
    }
  </script>

  <!-- React: í™”ë©´ì„ ì»´í¬ë„ŒíŠ¸ ë‹¨ìœ„ë¡œ ë§Œë“¤ ìˆ˜ ìˆê²Œ í•´ì£¼ëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬ -->
  <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>

  <!-- Babel: JSX ë¬¸ë²•(HTMLì²˜ëŸ¼ ìƒê¸´ JavaScript)ì„ ë¸Œë¼ìš°ì €ê°€ ì´í•´í•  ìˆ˜ ìˆê²Œ ë³€í™˜ -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <!-- í† ìŠ¤í˜ì´ë¨¼ì¸  SDK v2: ê²°ì œ ìœ„ì ¯ì„ ë Œë”ë§í•˜ê³  ê²°ì œë¥¼ ìš”ì²­í•˜ëŠ” ë„êµ¬ -->
  <script src="https://js.tosspayments.com/v2/standard"></script>

  <style>
    /* ë¶€ë“œëŸ¬ìš´ ìŠ¤í¬ë¡¤ íš¨ê³¼ */
    html { scroll-behavior: smooth; }

    /* ì¥ë°”êµ¬ë‹ˆ ìŠ¬ë¼ì´ë“œ ì• ë‹ˆë©”ì´ì…˜ */
    .cart-slide-in {
      animation: slideIn 0.3s ease-out;
    }
    @keyframes slideIn {
      from { transform: translateX(100%); } /* ì˜¤ë¥¸ìª½ ë°”ê¹¥ì—ì„œ */
      to { transform: translateX(0); }       /* ì œìë¦¬ë¡œ ìŠ¬ë¼ì´ë“œ */
    }

    /* ì±… ì¹´ë“œ í˜¸ë²„ ì‹œ ì‚´ì§ ìœ„ë¡œ ì˜¬ë¼ê°€ëŠ” íš¨ê³¼ */
    .book-card:hover {
      transform: translateY(-4px);
    }
  </style>
</head>

<body>
  <!-- Reactê°€ ì´ ì•ˆì— ëª¨ë“  í™”ë©´ì„ ê·¸ë ¤ì¤„ ê±°ì˜ˆìš” (ë„í™”ì§€ ê°™ì€ ì—­í• ) -->
  <div id="root"></div>

  <!-- type="text/babel"ë¡œ ì„¤ì •í•˜ë©´ Babelì´ JSXë¥¼ ë³€í™˜í•´ì¤˜ìš” -->
  <script type="text/babel">
    // ============================================
    // ğŸ“š 1ë‹¨ê³„: ë°ì´í„°ëŠ” ì„œë²„ APIì—ì„œ ë¡œë”©í•´ìš”
    // ============================================
    // ì´ì „ì—ëŠ” ì—¬ê¸°ì— ì±… ë°ì´í„°ë¥¼ ì§ì ‘ ë„£ì–´ë’€ì§€ë§Œ,
    // ì´ì œ ê´€ë¦¬ìê°€ ìƒí’ˆì„ ì¶”ê°€/ìˆ˜ì •/ì‚­ì œí•  ìˆ˜ ìˆë„ë¡
    // DBì—ì„œ ê´€ë¦¬í•˜ê³  APIë¥¼ í†µí•´ ë¶ˆëŸ¬ì™€ìš”
    // (App ì»´í¬ë„ŒíŠ¸ì˜ useEffectì—ì„œ /api/booksë¥¼ í˜¸ì¶œí•©ë‹ˆë‹¤)

    // ============================================
    // ğŸ“š 2ë‹¨ê³„: ê°€ê²© í¬ë§· í•¨ìˆ˜
    // ============================================
    // ìˆ«ìë¥¼ "45,000ì›" ê°™ì€ í˜•ì‹ìœ¼ë¡œ ë°”ê¿”ì£¼ëŠ” í•¨ìˆ˜
    function formatPrice(price) {
      return price.toLocaleString("ko-KR") + "ì›";
    }

    // ============================================
    // â­ 3ë‹¨ê³„: ë³„ì  ì»´í¬ë„ŒíŠ¸
    // ============================================
    // rating(ì˜ˆ: 4.5)ì„ ë°›ì•„ì„œ ë³„ ì•„ì´ì½˜ìœ¼ë¡œ í‘œì‹œí•´ì£¼ëŠ” ì»´í¬ë„ŒíŠ¸
    function StarRating({ rating }) {
      return (
        <div className="flex items-center gap-1">
          {/* ë³„ 5ê°œë¥¼ ìˆœì„œëŒ€ë¡œ ê·¸ë ¤ìš” */}
          {[1, 2, 3, 4, 5].map((star) => (
            <svg
              key={star}
              className={`w-4 h-4 ${
                /* í˜„ì¬ ë³„ ë²ˆí˜¸ê°€ rating ì´í•˜ë©´ ë…¸ë€ìƒ‰, ì•„ë‹ˆë©´ íšŒìƒ‰ */
                star <= Math.round(rating) ? "text-secondary" : "text-gray-300"
              }`}
              fill="currentColor"
              viewBox="0 0 20 20"
            >
              <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z" />
            </svg>
          ))}
          {/* ìˆ«ìë¡œë„ ë³„ì ì„ í‘œì‹œ */}
          <span className="text-sm text-gray-500 ml-1">{rating}</span>
        </div>
      );
    }

    // ============================================
    // ğŸƒ 4ë‹¨ê³„: ì±… ì¹´ë“œ ì»´í¬ë„ŒíŠ¸
    // ============================================
    // ê° ì±… í•˜ë‚˜ë¥¼ ì¹´ë“œ í˜•íƒœë¡œ ë³´ì—¬ì£¼ëŠ” ì»´í¬ë„ŒíŠ¸
    function BookCard({ book, onAddToCart }) {
      // í• ì¸ìœ¨ ê³„ì‚°: (ì›ë˜ê°€ê²© - í˜„ì¬ê°€ê²©) / ì›ë˜ê°€ê²© * 100
      // DBì—ì„œëŠ” snake_case(original_price)ë¥¼ ì‚¬ìš©í•´ìš”
      const discount = book.original_price > book.price
        ? Math.round((1 - book.price / book.original_price) * 100)
        : 0;

      return (
        <div className="book-card bg-white rounded-xl shadow-md overflow-hidden transition-all duration-300 hover:shadow-xl flex flex-col">
          {/*
            ì±… í‘œì§€ ì´ë¯¸ì§€ ì˜ì—­
            relative: ë°°ì§€ë¥¼ ì´ë¯¸ì§€ ìœ„ì— ê²¹ì³ë†“ê¸° ìœ„í•´ ì‚¬ìš©
          */}
          <div className="relative">
            <img
              src={book.image}
              alt={book.title}
              className="w-full h-64 object-cover"
              /* w-full: ë„ˆë¹„ë¥¼ ë¶€ëª¨ë§Œí¼ ê½‰ ì±„ì›€ */
              /* h-64: ë†’ì´ 256px ê³ ì • */
              /* object-cover: ë¹„ìœ¨ ìœ ì§€í•˜ë©´ì„œ ì˜ì—­ì„ ê½‰ ì±„ì›€ (ì˜ë¦´ ìˆ˜ ìˆìŒ) */
            />
            {/* ë°°ì§€ (ë² ìŠ¤íŠ¸ì…€ëŸ¬, í• ì¸ ë“±) - badgeê°€ ìˆì„ ë•Œë§Œ í‘œì‹œ */}
            {book.badge && (
              <span className="absolute top-2 left-2 bg-red-500 text-white text-xs font-bold px-2 py-1 rounded-full">
                {/* absolute: ë¶€ëª¨(relative) ê¸°ì¤€ìœ¼ë¡œ ìœ„ì¹˜ ì§€ì • */}
                {/* top-2 left-2: ì™¼ìª½ ìœ„ ëª¨ì„œë¦¬ì—ì„œ ì•½ê°„ ë–¨ì–´ì§„ ìœ„ì¹˜ */}
                {book.badge}
              </span>
            )}
          </div>

          {/* ì±… ì •ë³´ ì˜ì—­ */}
          <div className="p-4 flex flex-col flex-grow">
            {/* p-4: ì•ˆìª½ ì—¬ë°± 16px (ìƒì ì•ˆì˜ ë‚´ìš©ë¬¼ê³¼ í…Œë‘ë¦¬ ì‚¬ì´ ê°„ê²©) */}
            {/* flex-grow: ë‚¨ëŠ” ê³µê°„ì„ ì´ ì˜ì—­ì´ ì°¨ì§€í•˜ê²Œ í•¨ */}

            {/* ì¹´í…Œê³ ë¦¬ ë¼ë²¨ */}
            <span className="text-xs text-primary font-semibold uppercase tracking-wide">
              {book.category}
            </span>

            {/* ì±… ì œëª© */}
            <h3 className="mt-1 text-lg font-bold text-gray-900 line-clamp-2">
              {/* line-clamp-2: 2ì¤„ê¹Œì§€ë§Œ ë³´ì—¬ì£¼ê³  ë‚˜ë¨¸ì§€ëŠ” ... ì²˜ë¦¬ */}
              {book.title}
            </h3>

            {/* ì €ì */}
            <p className="text-sm text-gray-500 mt-1">{book.author}</p>

            {/* ë³„ì  */}
            <div className="mt-2">
              <StarRating rating={book.rating} />
            </div>

            {/* ê°€ê²© + ì¥ë°”êµ¬ë‹ˆ ë²„íŠ¼ ì˜ì—­ (ì¹´ë“œ í•˜ë‹¨ì— ê³ ì •) */}
            <div className="mt-auto pt-4">
              {/* mt-auto: ìœ„ìª½ ì—¬ë°±ì„ ìë™ìœ¼ë¡œ ìµœëŒ€í•œ ë„“í˜€ì„œ ì•„ë˜ë¡œ ë°€ì–´ëƒ„ */}
              <div className="flex items-end justify-between">
                <div>
                  {/* í• ì¸ì´ ìˆìœ¼ë©´ ì›ë˜ ê°€ê²©ì„ ì·¨ì†Œì„ ìœ¼ë¡œ í‘œì‹œ */}
                  {discount > 0 && (
                    <p className="text-xs text-gray-400 line-through">
                      {formatPrice(book.original_price)}
                    </p>
                  )}
                  <p className="text-xl font-bold text-gray-900">
                    {/* í• ì¸ìœ¨ í‘œì‹œ */}
                    {discount > 0 && (
                      <span className="text-red-500 mr-1">{discount}%</span>
                    )}
                    {formatPrice(book.price)}
                  </p>
                </div>

                {/* ì¥ë°”êµ¬ë‹ˆ ë‹´ê¸° ë²„íŠ¼ */}
                <button
                  onClick={() => onAddToCart(book)}
                  className="bg-primary hover:bg-blue-700 text-white p-2 rounded-lg transition-colors duration-200"
                  /* hover:bg-blue-700: ë§ˆìš°ìŠ¤ë¥¼ ì˜¬ë¦¬ë©´ ë” ì§„í•œ íŒŒë€ìƒ‰ìœ¼ë¡œ ë³€ê²½ */
                  /* transition-colors: ìƒ‰ìƒì´ ë¶€ë“œëŸ½ê²Œ ë³€í•˜ëŠ” íš¨ê³¼ */
                >
                  {/* ì¥ë°”êµ¬ë‹ˆ ì•„ì´ì½˜ (SVG) */}
                  <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 100 4 2 2 0 000-4z" />
                  </svg>
                </button>
              </div>
            </div>
          </div>
        </div>
      );
    }

    // ============================================
    // ğŸ›’ 5ë‹¨ê³„: ì¥ë°”êµ¬ë‹ˆ íŒ¨ë„ ì»´í¬ë„ŒíŠ¸
    // ============================================
    // ì˜¤ë¥¸ìª½ì—ì„œ ìŠ¬ë¼ì´ë“œë¡œ ì—´ë¦¬ëŠ” ì¥ë°”êµ¬ë‹ˆ í™”ë©´
    function CartPanel({ cart, onClose, onUpdateQuantity, onRemove, onCheckout }) {
      // ì´ ê¸ˆì•¡ ê³„ì‚°: ê° ìƒí’ˆì˜ (ê°€ê²© Ã— ìˆ˜ëŸ‰)ì„ ëª¨ë‘ ë”í•¨
      const totalPrice = cart.reduce(
        (sum, item) => sum + item.price * item.quantity,
        0  /* ì´ˆê¸°ê°’ 0ë¶€í„° ì‹œì‘ */
      );

      // ì´ ìˆ˜ëŸ‰ ê³„ì‚°
      const totalItems = cart.reduce((sum, item) => sum + item.quantity, 0);

      return (
        /* ì¥ë°”êµ¬ë‹ˆ ë°°ê²½ ì˜¤ë²„ë ˆì´ (ë°˜íˆ¬ëª… ê²€ì •) */
        <div
          className="fixed inset-0 z-50 flex justify-end"
          /* fixed: ìŠ¤í¬ë¡¤í•´ë„ í™”ë©´ì— ê³ ì • */
          /* inset-0: ìƒí•˜ì¢Œìš° ëª¨ë‘ 0 â†’ í™”ë©´ ì „ì²´ë¥¼ ë®ìŒ */
          /* z-50: ë‹¤ë¥¸ ìš”ì†Œë³´ë‹¤ ìœ„ì— í‘œì‹œ (ë ˆì´ì–´ ìˆœì„œ) */
          /* justify-end: ì˜¤ë¥¸ìª½ ëì— ì •ë ¬ */
        >
          {/* í´ë¦­í•˜ë©´ ì¥ë°”êµ¬ë‹ˆ ë‹«íˆëŠ” ë°˜íˆ¬ëª… ë°°ê²½ */}
          <div
            className="absolute inset-0 bg-black bg-opacity-50"
            onClick={onClose}
          />

          {/* ì¥ë°”êµ¬ë‹ˆ íŒ¨ë„ ë³¸ì²´ */}
          <div className="cart-slide-in relative w-full max-w-md bg-white shadow-2xl flex flex-col">
            {/* max-w-md: ìµœëŒ€ ë„ˆë¹„ 448px (ë„ˆë¬´ ë„“ì–´ì§€ì§€ ì•Šê²Œ) */}

            {/* ì¥ë°”êµ¬ë‹ˆ í—¤ë” */}
            <div className="flex items-center justify-between p-6 border-b">
              <h2 className="text-xl font-bold text-gray-900">
                ì¥ë°”êµ¬ë‹ˆ ({totalItems})
              </h2>
              {/* ë‹«ê¸°(X) ë²„íŠ¼ */}
              <button
                onClick={onClose}
                className="text-gray-400 hover:text-gray-600 transition-colors"
              >
                <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12" />
                </svg>
              </button>
            </div>

            {/* ì¥ë°”êµ¬ë‹ˆ ìƒí’ˆ ëª©ë¡ (ìŠ¤í¬ë¡¤ ê°€ëŠ¥) */}
            <div className="flex-1 overflow-y-auto p-6">
              {/* flex-1: ë‚¨ëŠ” ê³µê°„ì„ ëª¨ë‘ ì°¨ì§€ */}
              {/* overflow-y-auto: ë‚´ìš©ì´ ë„˜ì¹˜ë©´ ì„¸ë¡œ ìŠ¤í¬ë¡¤ ìƒì„± */}

              {cart.length === 0 ? (
                /* ì¥ë°”êµ¬ë‹ˆê°€ ë¹„ì–´ìˆì„ ë•Œ */
                <div className="text-center py-16">
                  <svg className="w-16 h-16 mx-auto text-gray-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={1.5} d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 100 4 2 2 0 000-4z" />
                  </svg>
                  <p className="mt-4 text-gray-500">ì¥ë°”êµ¬ë‹ˆê°€ ë¹„ì–´ìˆìŠµë‹ˆë‹¤</p>
                </div>
              ) : (
                /* ì¥ë°”êµ¬ë‹ˆì— ìƒí’ˆì´ ìˆì„ ë•Œ */
                <div className="space-y-4">
                  {/* space-y-4: ìì‹ ìš”ì†Œë“¤ ì‚¬ì´ì— 16px ê°„ê²© */}
                  {cart.map((item) => (
                    <div key={item.id} className="flex gap-4 bg-gray-50 rounded-lg p-3">
                      {/* ì‘ì€ ì±… í‘œì§€ ì´ë¯¸ì§€ */}
                      <img
                        src={item.image}
                        alt={item.title}
                        className="w-16 h-20 object-cover rounded"
                      />
                      <div className="flex-1 min-w-0">
                        {/* min-w-0: í…ìŠ¤íŠ¸ê°€ ë„˜ì¹  ë•Œ ì¤„ì„(...) ì²˜ë¦¬ ê°€ëŠ¥í•˜ê²Œ */}
                        <h4 className="font-semibold text-sm text-gray-900 truncate">
                          {item.title}
                        </h4>
                        <p className="text-xs text-gray-500">{item.author}</p>
                        <p className="text-sm font-bold text-primary mt-1">
                          {formatPrice(item.price)}
                        </p>

                        {/* ìˆ˜ëŸ‰ ì¡°ì ˆ ë²„íŠ¼ */}
                        <div className="flex items-center gap-2 mt-2">
                          {/* ìˆ˜ëŸ‰ ê°ì†Œ ë²„íŠ¼ */}
                          <button
                            onClick={() => onUpdateQuantity(item.id, item.quantity - 1)}
                            className="w-6 h-6 rounded bg-gray-200 hover:bg-gray-300 flex items-center justify-center text-sm font-bold transition-colors"
                          >
                            âˆ’
                          </button>
                          {/* í˜„ì¬ ìˆ˜ëŸ‰ */}
                          <span className="text-sm font-semibold w-6 text-center">
                            {item.quantity}
                          </span>
                          {/* ìˆ˜ëŸ‰ ì¦ê°€ ë²„íŠ¼ */}
                          <button
                            onClick={() => onUpdateQuantity(item.id, item.quantity + 1)}
                            className="w-6 h-6 rounded bg-gray-200 hover:bg-gray-300 flex items-center justify-center text-sm font-bold transition-colors"
                          >
                            +
                          </button>
                          {/* ì‚­ì œ ë²„íŠ¼ */}
                          <button
                            onClick={() => onRemove(item.id)}
                            className="ml-auto text-red-400 hover:text-red-600 transition-colors"
                          >
                            <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                            </svg>
                          </button>
                        </div>
                      </div>
                    </div>
                  ))}
                </div>
              )}
            </div>

            {/* ì¥ë°”êµ¬ë‹ˆ í•˜ë‹¨: ì´ ê¸ˆì•¡ + ì£¼ë¬¸ ë²„íŠ¼ */}
            {cart.length > 0 && (
              <div className="border-t p-6 space-y-4">
                {/* ë°°ì†¡ë¹„ ì•ˆë‚´ */}
                <div className="flex justify-between text-sm text-gray-500">
                  <span>ë°°ì†¡ë¹„</span>
                  <span>{totalPrice >= 30000 ? "ë¬´ë£Œ" : formatPrice(3000)}</span>
                </div>
                {/* ì´ ê²°ì œ ê¸ˆì•¡ */}
                <div className="flex justify-between text-lg font-bold">
                  <span>ì´ ê²°ì œê¸ˆì•¡</span>
                  <span className="text-primary">
                    {formatPrice(totalPrice >= 30000 ? totalPrice : totalPrice + 3000)}
                  </span>
                </div>
                {/* 3ë§Œì› ì´ìƒ ë¬´ë£Œë°°ì†¡ ì•ˆë‚´ */}
                {totalPrice < 30000 && (
                  <p className="text-xs text-accent text-center">
                    {formatPrice(30000 - totalPrice)} ë” ë‹´ìœ¼ë©´ ë¬´ë£Œë°°ì†¡!
                  </p>
                )}
                {/* ì£¼ë¬¸í•˜ê¸° ë²„íŠ¼ â€” í´ë¦­í•˜ë©´ ê²°ì œ í˜ì´ì§€ë¡œ ì´ë™ */}
                <button
                  onClick={onCheckout}
                  className="w-full bg-primary hover:bg-blue-700 text-white font-bold py-3 rounded-xl transition-colors duration-200"
                >
                  ì£¼ë¬¸í•˜ê¸°
                </button>
              </div>
            )}
          </div>
        </div>
      );
    }

    // ============================================
    // ğŸ’³ 6ë‹¨ê³„: ê²°ì œ í˜ì´ì§€ ì»´í¬ë„ŒíŠ¸
    // ============================================
    // í† ìŠ¤í˜ì´ë¨¼ì¸  ê²°ì œ ìœ„ì ¯ì„ ë Œë”ë§í•˜ê³ , "ê²°ì œí•˜ê¸°" ë²„íŠ¼ì„ ëˆ„ë¥´ë©´ ê²°ì œë¥¼ ì§„í–‰í•´ìš”
    //
    // ë™ì‘ íë¦„:
    // 1. ì»´í¬ë„ŒíŠ¸ê°€ í™”ë©´ì— ë‚˜íƒ€ë‚¨ (mount)
    // 2. useEffectì—ì„œ í† ìŠ¤í˜ì´ë¨¼ì¸  ìœ„ì ¯ ì´ˆê¸°í™”
    // 3. ê²°ì œ ìˆ˜ë‹¨ ì„ íƒ UI + ì•½ê´€ ë™ì˜ UI ë Œë”ë§
    // 4. "ê²°ì œí•˜ê¸°" ë²„íŠ¼ í´ë¦­ â†’ requestPayment() â†’ í† ìŠ¤ ê²°ì œ ì°½ ì—´ë¦¼
    // 5. ê²°ì œ ì™„ë£Œ í›„ /success ë˜ëŠ” /failë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸
    function CheckoutPage({ cart, user, onBack, showToast }) {
      // ìœ„ì ¯ ë¡œë”© ìƒíƒœì™€ ì—ëŸ¬ ìƒíƒœ
      const [loading, setLoading] = React.useState(true);
      const [error, setError] = React.useState('');
      // useRef: ë¦¬ë Œë”ë§ ì—†ì´ ê°’ì„ ê¸°ì–µí•˜ëŠ” ë„êµ¬ (ìœ„ì ¯ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ì €ì¥)
      const widgetsRef = React.useRef(null);

      // --- ê¸ˆì•¡ ê³„ì‚° ---
      // ìƒí’ˆ ê¸ˆì•¡ í•©ê³„
      const totalPrice = cart.reduce((sum, item) => sum + item.price * item.quantity, 0);
      // ë°°ì†¡ë¹„: 3ë§Œì› ì´ìƒì´ë©´ ë¬´ë£Œ, ë¯¸ë§Œì´ë©´ 3,000ì›
      const shippingFee = totalPrice >= 30000 ? 0 : 3000;
      // ìµœì¢… ê²°ì œ ê¸ˆì•¡
      const finalAmount = totalPrice + shippingFee;

      // ì£¼ë¬¸ëª… ìƒì„± (ì˜ˆ: "ëª¨ë˜ ìë°”ìŠ¤í¬ë¦½íŠ¸ Deep Dive ì™¸ 2ê±´")
      const orderName = cart.length === 1
        ? cart[0].title
        : cart[0].title + ' ì™¸ ' + (cart.length - 1) + 'ê±´';

      // --- í† ìŠ¤í˜ì´ë¨¼ì¸  ìœ„ì ¯ ì´ˆê¸°í™” ---
      // ì»´í¬ë„ŒíŠ¸ê°€ í™”ë©´ì— ë‚˜íƒ€ë‚  ë•Œ í•œ ë²ˆë§Œ ì‹¤í–‰ë¼ìš”
      React.useEffect(() => {
        async function initWidget() {
          try {
            // 1. í† ìŠ¤í˜ì´ë¨¼ì¸  ê°ì²´ ìƒì„± (í´ë¼ì´ì–¸íŠ¸í‚¤ í•„ìš”)
            const clientKey = 'test_gck_docs_Ovk5rk1EwkEbP0W43n07xlzm';
            // ë¡œê·¸ì¸í•œ ì‚¬ìš©ìì˜ ê³ ìœ  IDë¥¼ customerKeyë¡œ ì‚¬ìš©
            const customerKey = 'bookshop_user_' + user.id;
            const tossPayments = TossPayments(clientKey);

            // 2. ê²°ì œ ìœ„ì ¯ ì¸ìŠ¤í„´ìŠ¤ ìƒì„±
            const widgets = tossPayments.widgets({ customerKey });

            // 3. ê²°ì œ ê¸ˆì•¡ ì„¤ì • (ìœ„ì ¯ ë Œë”ë§ ì „ì— ë°˜ë“œì‹œ ë¨¼ì € í˜¸ì¶œí•´ì•¼ í•´ìš”)
            await widgets.setAmount({
              currency: 'KRW',    // í†µí™”: í•œêµ­ ì›
              value: finalAmount,  // ê¸ˆì•¡: ìƒí’ˆê°€ + ë°°ì†¡ë¹„
            });

            // 4. ê²°ì œ ìˆ˜ë‹¨ ì„ íƒ UI + ì•½ê´€ ë™ì˜ UIë¥¼ ë™ì‹œì— ë Œë”ë§
            // Promise.all: ë‘ ì‘ì—…ì„ ë™ì‹œì— ì‹¤í–‰í•˜ê³  ë‘˜ ë‹¤ ëë‚  ë•Œê¹Œì§€ ëŒ€ê¸°
            await Promise.all([
              widgets.renderPaymentMethods({
                selector: '#payment-method',  // ì´ div ì•ˆì— ê²°ì œ ìˆ˜ë‹¨ UIê°€ ê·¸ë ¤ì ¸ìš”
                variantKey: 'DEFAULT',
              }),
              widgets.renderAgreement({
                selector: '#agreement',       // ì´ div ì•ˆì— ì•½ê´€ ë™ì˜ UIê°€ ê·¸ë ¤ì ¸ìš”
                variantKey: 'AGREEMENT',
              }),
            ]);

            // ìœ„ì ¯ ì¸ìŠ¤í„´ìŠ¤ë¥¼ refì— ì €ì¥ (ê²°ì œ ìš”ì²­ ì‹œ ì‚¬ìš©)
            widgetsRef.current = widgets;
            setLoading(false);
          } catch (err) {
            console.error('ê²°ì œ ìœ„ì ¯ ì´ˆê¸°í™” ì˜¤ë¥˜:', err);
            setError('ê²°ì œ ìœ„ì ¯ì„ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤');
            setLoading(false);
          }
        }

        initWidget();
      }, []);

      // --- ê²°ì œ ìš”ì²­ í•¨ìˆ˜ ---
      // "ê²°ì œí•˜ê¸°" ë²„íŠ¼ì„ ëˆ„ë¥´ë©´ ì‹¤í–‰ë¼ìš”
      async function handlePayment() {
        if (!widgetsRef.current) return;

        try {
          // ì£¼ë¬¸ ID ìƒì„±: íƒ€ì„ìŠ¤íƒ¬í”„ + ëœë¤ ë¬¸ìì—´ë¡œ ê³ ìœ í•œ ê°’ì„ ë§Œë“¤ì–´ìš”
          // í† ìŠ¤í˜ì´ë¨¼ì¸  ê·œê²©: 6ì ì´ìƒ 64ì ì´í•˜, ì˜ë¬¸/ìˆ«ì/-/_ ë§Œ í—ˆìš©
          const orderId = 'BOOKSHOP_' + Date.now() + '_' + Math.random().toString(36).substring(2, 8);

          // í† ìŠ¤í˜ì´ë¨¼ì¸  ê²°ì œ ìš”ì²­!
          // ì´ í•¨ìˆ˜ê°€ í˜¸ì¶œë˜ë©´ í† ìŠ¤ ê²°ì œ ì°½ì´ ì—´ë¦¬ê³ ,
          // ê²°ì œê°€ ì™„ë£Œë˜ë©´ successUrlë¡œ, ì‹¤íŒ¨í•˜ë©´ failUrlë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸ë¼ìš”
          await widgetsRef.current.requestPayment({
            orderId: orderId,
            orderName: orderName,
            successUrl: window.location.origin + '/success',
            failUrl: window.location.origin + '/fail',
            customerEmail: user.email,
            customerName: user.email.split('@')[0],
          });
        } catch (err) {
          // ì‚¬ìš©ìê°€ ê²°ì œ ì°½ì„ ë‹«ì€ ê²½ìš°
          if (err.code === 'USER_CANCEL') {
            showToast('ê²°ì œê°€ ì·¨ì†Œë˜ì—ˆìŠµë‹ˆë‹¤');
          } else {
            showToast('ê²°ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤');
          }
        }
      }

      return (
        <div className="min-h-screen bg-gray-50">
          {/* ìƒë‹¨ í—¤ë”: ë’¤ë¡œê°€ê¸° + ì œëª© */}
          <header className="bg-white shadow-sm sticky top-0 z-40">
            <div className="max-w-3xl mx-auto px-4 py-4 flex items-center gap-4">
              <button onClick={onBack} className="text-gray-600 hover:text-gray-900 transition-colors">
                {/* ì™¼ìª½ í™”ì‚´í‘œ ì•„ì´ì½˜ (ë’¤ë¡œê°€ê¸°) */}
                <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 19l-7-7 7-7" />
                </svg>
              </button>
              <h1 className="text-xl font-bold text-gray-900">ì£¼ë¬¸/ê²°ì œ</h1>
            </div>
          </header>

          <main className="max-w-3xl mx-auto px-4 py-8 space-y-6">
            {/* === ì£¼ë¬¸ ìƒí’ˆ ìš”ì•½ ì¹´ë“œ === */}
            <div className="bg-white rounded-xl shadow-sm p-6">
              <h2 className="text-lg font-bold text-gray-900 mb-4">ì£¼ë¬¸ ìƒí’ˆ</h2>
              <div className="space-y-3">
                {cart.map((item) => (
                  <div key={item.id} className="flex items-center gap-3">
                    <img src={item.image} alt={item.title} className="w-12 h-16 object-cover rounded" />
                    <div className="flex-1">
                      <p className="text-sm font-medium text-gray-900">{item.title}</p>
                      <p className="text-xs text-gray-500">{item.author} | {item.quantity}ê¶Œ</p>
                    </div>
                    <p className="text-sm font-bold text-gray-900">{formatPrice(item.price * item.quantity)}</p>
                  </div>
                ))}
              </div>
              {/* ê¸ˆì•¡ í•©ê³„ */}
              <div className="border-t mt-4 pt-4 space-y-2">
                <div className="flex justify-between text-sm text-gray-500">
                  <span>ìƒí’ˆ ê¸ˆì•¡</span>
                  <span>{formatPrice(totalPrice)}</span>
                </div>
                <div className="flex justify-between text-sm text-gray-500">
                  <span>ë°°ì†¡ë¹„</span>
                  <span>{shippingFee === 0 ? 'ë¬´ë£Œ' : formatPrice(shippingFee)}</span>
                </div>
                <div className="flex justify-between text-lg font-bold text-gray-900">
                  <span>ì´ ê²°ì œê¸ˆì•¡</span>
                  <span className="text-primary">{formatPrice(finalAmount)}</span>
                </div>
              </div>
            </div>

            {/* === ê²°ì œ ìˆ˜ë‹¨ ìœ„ì ¯ (í† ìŠ¤í˜ì´ë¨¼ì¸  SDKê°€ ì´ ì•ˆì— UIë¥¼ ê·¸ë ¤ì¤˜ìš”) === */}
            <div className="bg-white rounded-xl shadow-sm p-6">
              {loading && (
                <div className="text-center py-8">
                  <div className="inline-block w-8 h-8 border-4 border-primary border-t-transparent rounded-full animate-spin"></div>
                  <p className="text-gray-500 mt-3">ê²°ì œ ìˆ˜ë‹¨ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
                </div>
              )}
              {error && (
                <div className="text-center py-8">
                  <p className="text-red-500">{error}</p>
                </div>
              )}
              <div id="payment-method"></div>
            </div>

            {/* === ì•½ê´€ ë™ì˜ ìœ„ì ¯ === */}
            <div className="bg-white rounded-xl shadow-sm p-6">
              <div id="agreement"></div>
            </div>

            {/* === ê²°ì œí•˜ê¸° ë²„íŠ¼ === */}
            <button
              onClick={handlePayment}
              disabled={loading || !!error}
              className="w-full bg-primary hover:bg-blue-700 text-white font-bold py-4 rounded-xl transition-colors duration-200 disabled:opacity-50 text-lg"
            >
              {formatPrice(finalAmount)} ê²°ì œí•˜ê¸°
            </button>
          </main>
        </div>
      );
    }

    // ============================================
    // âœ… ê²°ì œ ì„±ê³µ í˜ì´ì§€ ì»´í¬ë„ŒíŠ¸
    // ============================================
    // ê²°ì œê°€ ì™„ë£Œëœ í›„ ë³´ì—¬ì£¼ëŠ” í™”ë©´ì´ì—ìš”
    // ì£¼ë¬¸ë²ˆí˜¸, ê²°ì œê¸ˆì•¡, ê²°ì œìˆ˜ë‹¨ ë“±ì˜ ì •ë³´ë¥¼ í‘œì‹œí•©ë‹ˆë‹¤
    function SuccessPage({ result, onGoHome }) {
      // resultê°€ ì•„ì§ ì—†ìœ¼ë©´ (ì„œë²„ ìŠ¹ì¸ ì²˜ë¦¬ ì¤‘) ë¡œë”© í‘œì‹œ
      if (!result) {
        return (
          <div className="min-h-screen bg-gray-50 flex items-center justify-center">
            <div className="text-center">
              <div className="inline-block w-10 h-10 border-4 border-primary border-t-transparent rounded-full animate-spin"></div>
              <p className="text-gray-500 mt-4">ê²°ì œ ìŠ¹ì¸ ì²˜ë¦¬ ì¤‘...</p>
            </div>
          </div>
        );
      }

      return (
        <div className="min-h-screen bg-gray-50 flex items-center justify-center p-4">
          <div className="bg-white rounded-2xl shadow-lg max-w-md w-full p-8 text-center">
            {/* ì„±ê³µ ì²´í¬ ì•„ì´ì½˜ (ì´ˆë¡ìƒ‰ ì› ì•ˆì— ì²´í¬) */}
            <div className="w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4">
              <svg className="w-8 h-8 text-accent" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M5 13l4 4L19 7" />
              </svg>
            </div>
            <h2 className="text-2xl font-bold text-gray-900 mb-2">ê²°ì œê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤</h2>
            <p className="text-gray-500 mb-6">ì£¼ë¬¸ì´ ì •ìƒì ìœ¼ë¡œ ì ‘ìˆ˜ë˜ì—ˆìŠµë‹ˆë‹¤</p>

            {/* ì£¼ë¬¸ ìƒì„¸ ì •ë³´ */}
            {result.data && (
              <div className="bg-gray-50 rounded-lg p-4 mb-6 text-left space-y-2">
                <div className="flex justify-between text-sm">
                  <span className="text-gray-500">ì£¼ë¬¸ë²ˆí˜¸</span>
                  <span className="font-medium text-gray-900">{result.data.orderId}</span>
                </div>
                <div className="flex justify-between text-sm">
                  <span className="text-gray-500">ê²°ì œê¸ˆì•¡</span>
                  <span className="font-bold text-primary">
                    {formatPrice(result.data.totalAmount)}
                  </span>
                </div>
                <div className="flex justify-between text-sm">
                  <span className="text-gray-500">ê²°ì œìˆ˜ë‹¨</span>
                  <span className="font-medium text-gray-900">{result.data.method || 'ì¹´ë“œ'}</span>
                </div>
              </div>
            )}

            <button
              onClick={() => {
                // ë¸Œë¼ìš°ì € URLì„ í™ˆ(/)ìœ¼ë¡œ ê¹¨ë—í•˜ê²Œ ë³€ê²½ (ë’¤ë¡œê°€ê¸° ì‹œ /successë¡œ ì•ˆ ê°)
                window.history.replaceState(null, '', '/');
                onGoHome();
              }}
              className="w-full bg-primary hover:bg-blue-700 text-white font-bold py-3 rounded-xl transition-colors"
            >
              í™ˆìœ¼ë¡œ ëŒì•„ê°€ê¸°
            </button>
          </div>
        </div>
      );
    }

    // ============================================
    // âŒ ê²°ì œ ì‹¤íŒ¨ í˜ì´ì§€ ì»´í¬ë„ŒíŠ¸
    // ============================================
    // ê²°ì œê°€ ì‹¤íŒ¨í–ˆì„ ë•Œ ë³´ì—¬ì£¼ëŠ” í™”ë©´ì´ì—ìš”
    // ì—ëŸ¬ ì½”ë“œì™€ ë©”ì‹œì§€ë¥¼ í‘œì‹œí•©ë‹ˆë‹¤
    function FailPage({ result, onGoHome }) {
      return (
        <div className="min-h-screen bg-gray-50 flex items-center justify-center p-4">
          <div className="bg-white rounded-2xl shadow-lg max-w-md w-full p-8 text-center">
            {/* ì‹¤íŒ¨ X ì•„ì´ì½˜ (ë¹¨ê°„ìƒ‰ ì› ì•ˆì— X) */}
            <div className="w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4">
              <svg className="w-8 h-8 text-red-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12" />
              </svg>
            </div>
            <h2 className="text-2xl font-bold text-gray-900 mb-2">ê²°ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤</h2>
            <p className="text-gray-500 mb-6">
              {result?.message || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤'}
            </p>

            {/* ì—ëŸ¬ ì½”ë“œ í‘œì‹œ */}
            {result?.code && (
              <p className="text-xs text-gray-400 mb-6">ì˜¤ë¥˜ ì½”ë“œ: {result.code}</p>
            )}

            <button
              onClick={() => {
                window.history.replaceState(null, '', '/');
                onGoHome();
              }}
              className="w-full bg-primary hover:bg-blue-700 text-white font-bold py-3 rounded-xl transition-colors"
            >
              í™ˆìœ¼ë¡œ ëŒì•„ê°€ê¸°
            </button>
          </div>
        </div>
      );
    }

    // ============================================
    // ğŸ“– 7ë‹¨ê³„: ì±… ìƒì„¸ ëª¨ë‹¬ ì»´í¬ë„ŒíŠ¸
    // ============================================
    function BookDetail({ book, onClose, onAddToCart }) {
      if (!book) return null;

      const discount = book.original_price > book.price
        ? Math.round((1 - book.price / book.original_price) * 100)
        : 0;

      return (
        <div className="fixed inset-0 z-50 flex items-center justify-center p-4">
          {/* ë°°ê²½ ì˜¤ë²„ë ˆì´ */}
          <div className="absolute inset-0 bg-black bg-opacity-50" onClick={onClose} />

          {/* ëª¨ë‹¬ ë³¸ì²´ */}
          <div className="relative bg-white rounded-2xl shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto">
            {/* ë‹«ê¸° ë²„íŠ¼ */}
            <button
              onClick={onClose}
              className="absolute top-4 right-4 z-10 bg-white rounded-full p-1 shadow-md text-gray-400 hover:text-gray-600"
            >
              <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12" />
              </svg>
            </button>

            <div className="md:flex">
              {/* ì±… í‘œì§€ */}
              <div className="md:w-1/2">
                <img
                  src={book.image}
                  alt={book.title}
                  className="w-full h-72 md:h-full object-cover rounded-t-2xl md:rounded-l-2xl md:rounded-tr-none"
                />
              </div>
              {/* ì±… ì •ë³´ */}
              <div className="p-6 md:w-1/2 flex flex-col">
                <span className="text-sm text-primary font-semibold">{book.category}</span>
                <h2 className="text-2xl font-bold text-gray-900 mt-1">{book.title}</h2>
                <p className="text-gray-500 mt-1">{book.author}</p>
                <div className="mt-3">
                  <StarRating rating={book.rating} />
                </div>
                <p className="text-gray-600 mt-4 leading-relaxed">{book.description}</p>

                <div className="mt-auto pt-6">
                  <div className="mb-4">
                    {discount > 0 && (
                      <p className="text-sm text-gray-400 line-through">
                        {formatPrice(book.original_price)}
                      </p>
                    )}
                    <p className="text-2xl font-bold">
                      {discount > 0 && (
                        <span className="text-red-500 mr-1">{discount}%</span>
                      )}
                      {formatPrice(book.price)}
                    </p>
                  </div>
                  <button
                    onClick={() => { onAddToCart(book); onClose(); }}
                    className="w-full bg-primary hover:bg-blue-700 text-white font-bold py-3 rounded-xl transition-colors duration-200"
                  >
                    ì¥ë°”êµ¬ë‹ˆì— ë‹´ê¸°
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>
      );
    }

    // ============================================
    // ğŸ”‘ 7ë‹¨ê³„: ë¡œê·¸ì¸ ëª¨ë‹¬ ì»´í¬ë„ŒíŠ¸
    // ============================================
    // ì´ë©”ì¼ê³¼ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥ë°›ì•„ ì„œë²„ì— ë¡œê·¸ì¸ ìš”ì²­ì„ ë³´ë‚´ëŠ” í™”ë©´
    function LoginModal({ onClose, onSwitchToRegister, onLoginSuccess }) {
      // ì…ë ¥ê°’ê³¼ ìƒíƒœë¥¼ ê´€ë¦¬í•˜ëŠ” stateë“¤
      const [email, setEmail] = React.useState('');
      const [password, setPassword] = React.useState('');
      const [error, setError] = React.useState('');       // ì—ëŸ¬ ë©”ì‹œì§€
      const [loading, setLoading] = React.useState(false); // ë¡œë”© ì¤‘ ì—¬ë¶€
      const [showPassword, setShowPassword] = React.useState(false); // ë¹„ë°€ë²ˆí˜¸ ë³´ê¸° ì—¬ë¶€

      // í¼ ì œì¶œ ì‹œ ì‹¤í–‰ë˜ëŠ” í•¨ìˆ˜
      async function handleSubmit(e) {
        e.preventDefault(); // í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨ ë°©ì§€ (í¼ì˜ ê¸°ë³¸ ë™ì‘)
        setError('');
        setLoading(true);

        try {
          // ì„œë²„ì˜ ë¡œê·¸ì¸ APIì— ìš”ì²­ ë³´ë‚´ê¸°
          const res = await fetch('/api/login', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ email, password })
            // JSON.stringify: ìë°”ìŠ¤í¬ë¦½íŠ¸ ê°ì²´ë¥¼ JSON ë¬¸ìì—´ë¡œ ë³€í™˜
          });

          const data = await res.json(); // ì„œë²„ ì‘ë‹µì„ JSONìœ¼ë¡œ ë³€í™˜

          if (res.ok) {
            // ë¡œê·¸ì¸ ì„±ê³µ!
            // í† í°ì„ localStorageì— ì €ì¥ (ë¸Œë¼ìš°ì €ë¥¼ ë‹«ì•„ë„ ìœ ì§€ë¨)
            localStorage.setItem('token', data.token);
            onLoginSuccess(data.user); // ë¶€ëª¨ ì»´í¬ë„ŒíŠ¸ì— ì‚¬ìš©ì ì •ë³´ ì „ë‹¬
            onClose(); // ëª¨ë‹¬ ë‹«ê¸°
          } else {
            // ë¡œê·¸ì¸ ì‹¤íŒ¨ (ì´ë©”ì¼/ë¹„ë°€ë²ˆí˜¸ í‹€ë¦¼ ë“±)
            setError(data.error);
          }
        } catch (err) {
          setError('ì„œë²„ ì—°ê²°ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤');
        }
        setLoading(false);
      }

      return (
        <div className="fixed inset-0 z-50 flex items-center justify-center p-4">
          {/* ë°˜íˆ¬ëª… ë°°ê²½ ì˜¤ë²„ë ˆì´ */}
          <div className="absolute inset-0 bg-black bg-opacity-50" onClick={onClose} />

          {/* ëª¨ë‹¬ ë³¸ì²´ */}
          <div className="relative bg-white rounded-2xl shadow-2xl max-w-md w-full p-8">
            {/* ë‹«ê¸° ë²„íŠ¼ */}
            <button onClick={onClose} className="absolute top-4 right-4 text-gray-400 hover:text-gray-600">
              <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12" />
              </svg>
            </button>

            {/* ì œëª© */}
            <h2 className="text-2xl font-bold text-gray-900 mb-6">ë¡œê·¸ì¸</h2>

            {/* ì—ëŸ¬ ë©”ì‹œì§€ (ìˆì„ ë•Œë§Œ í‘œì‹œ) */}
            {error && (
              <p className="text-red-500 text-sm mb-4 bg-red-50 p-3 rounded-lg">{error}</p>
            )}

            {/* ë¡œê·¸ì¸ í¼ */}
            <form onSubmit={handleSubmit} className="space-y-4">
              {/* space-y-4: í¼ ì•ˆì˜ ê° ì…ë ¥ í•„ë“œ ì‚¬ì´ ê°„ê²© 16px */}
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-1">ì´ë©”ì¼</label>
                <input
                  type="email"
                  value={email}
                  onChange={(e) => setEmail(e.target.value)}
                  required
                  placeholder="example@email.com"
                  className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:outline-none"
                />
              </div>
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-1">ë¹„ë°€ë²ˆí˜¸</label>
                {/* ë¹„ë°€ë²ˆí˜¸ ì…ë ¥ + ë³´ê¸°/ìˆ¨ê¸°ê¸° ë²„íŠ¼ì„ ê°ì‹¸ëŠ” ì»¨í…Œì´ë„ˆ */}
                <div className="relative">
                  <input
                    type={showPassword ? "text" : "password"}
                    value={password}
                    onChange={(e) => setPassword(e.target.value)}
                    required
                    placeholder="ë¹„ë°€ë²ˆí˜¸ ì…ë ¥"
                    className="w-full px-4 py-2 pr-10 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:outline-none"
                  />
                  {/* ëˆˆ ì•„ì´ì½˜: í´ë¦­í•˜ë©´ ë¹„ë°€ë²ˆí˜¸ ë³´ê¸°/ìˆ¨ê¸°ê¸° í† ê¸€ */}
                  <button
                    type="button"
                    onClick={() => setShowPassword(!showPassword)}
                    className="absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-600"
                  >
                    {showPassword ? (
                      /* ëˆˆ ê°ì€ ì•„ì´ì½˜ (ë¹„ë°€ë²ˆí˜¸ ë³´ì´ëŠ” ìƒíƒœ â†’ í´ë¦­í•˜ë©´ ìˆ¨ê¹€) */
                      <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.878 9.878L3 3m6.878 6.878L21 21" />
                      </svg>
                    ) : (
                      /* ëˆˆ ëœ¬ ì•„ì´ì½˜ (ë¹„ë°€ë²ˆí˜¸ ìˆ¨ê¸´ ìƒíƒœ â†’ í´ë¦­í•˜ë©´ ë³´ì„) */
                      <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" />
                      </svg>
                    )}
                  </button>
                </div>
              </div>
              <button
                type="submit"
                disabled={loading}
                className="w-full bg-primary hover:bg-blue-700 text-white font-bold py-3 rounded-xl transition-colors disabled:opacity-50"
                /* disabled:opacity-50: ë¡œë”© ì¤‘ì¼ ë•Œ ë²„íŠ¼ì„ ë°˜íˆ¬ëª…í•˜ê²Œ */
              >
                {loading ? 'ë¡œê·¸ì¸ ì¤‘...' : 'ë¡œê·¸ì¸'}
              </button>
            </form>

            {/* íšŒì›ê°€ì…ìœ¼ë¡œ ì „í™˜ ë§í¬ */}
            <p className="text-center text-sm text-gray-500 mt-4">
              ê³„ì •ì´ ì—†ìœ¼ì‹ ê°€ìš”?{' '}
              <button onClick={onSwitchToRegister} className="text-primary font-semibold hover:underline">
                íšŒì›ê°€ì…
              </button>
            </p>
          </div>
        </div>
      );
    }

    // ============================================
    // ğŸ“ 8ë‹¨ê³„: íšŒì›ê°€ì… ëª¨ë‹¬ ì»´í¬ë„ŒíŠ¸
    // ============================================
    // ì´ë¦„, ì´ë©”ì¼, ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥ë°›ì•„ ì„œë²„ì— ê°€ì… ìš”ì²­ì„ ë³´ë‚´ëŠ” í™”ë©´
    function RegisterModal({ onClose, onSwitchToLogin }) {
      const [email, setEmail] = React.useState('');
      const [password, setPassword] = React.useState('');
      const [error, setError] = React.useState('');
      const [loading, setLoading] = React.useState(false);
      const [showPassword, setShowPassword] = React.useState(false); // ë¹„ë°€ë²ˆí˜¸ ë³´ê¸° ì—¬ë¶€

      // ë¹„ë°€ë²ˆí˜¸ ê·œì¹™ ì‹¤ì‹œê°„ ê²€ì¦ (ì…ë ¥í•  ë•Œë§ˆë‹¤ ì²´í¬)
      // ì„œë²„ì˜ validatePasswordStrength ê·œì¹™ê³¼ ë™ì¼í•˜ê²Œ ë§ì¶¤
      const passwordRules = [
        { label: '8ì ì´ìƒ', met: password.length >= 8 },
        { label: 'ëŒ€ë¬¸ì í¬í•¨ (A-Z)', met: /[A-Z]/.test(password) },
        { label: 'ìˆ«ì í¬í•¨ (0-9)', met: /\d/.test(password) },
        { label: 'íŠ¹ìˆ˜ë¬¸ì í¬í•¨ (!@#$%^&* ë“±)', met: /[!@#$%^&*(),.?":{}|<>]/.test(password) },
      ];
      const allRulesMet = passwordRules.every(r => r.met);

      async function handleSubmit(e) {
        e.preventDefault();
        setError('');

        // ë¹„ë°€ë²ˆí˜¸ ê·œì¹™ ê²€ì¦ (ì„œë²„ì™€ ë™ì¼í•œ ê·œì¹™ìœ¼ë¡œ ë¯¸ë¦¬ í™•ì¸)
        if (!allRulesMet) {
          setError('ë¹„ë°€ë²ˆí˜¸ê°€ ì•„ë˜ ê·œì¹™ì„ ëª¨ë‘ ë§Œì¡±í•´ì•¼ í•©ë‹ˆë‹¤');
          return;
        }

        setLoading(true);

        try {
          const res = await fetch('/api/register', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ email, password })
          });

          const data = await res.json();

          if (res.ok) {
            // íšŒì›ê°€ì… ì„±ê³µ â†’ ë¡œê·¸ì¸ ëª¨ë‹¬ë¡œ ì „í™˜
            onSwitchToLogin();
          } else {
            setError(data.error);
          }
        } catch (err) {
          setError('ì„œë²„ ì—°ê²°ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤');
        }
        setLoading(false);
      }

      return (
        <div className="fixed inset-0 z-50 flex items-center justify-center p-4">
          <div className="absolute inset-0 bg-black bg-opacity-50" onClick={onClose} />

          <div className="relative bg-white rounded-2xl shadow-2xl max-w-md w-full p-8">
            <button onClick={onClose} className="absolute top-4 right-4 text-gray-400 hover:text-gray-600">
              <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12" />
              </svg>
            </button>

            <h2 className="text-2xl font-bold text-gray-900 mb-6">íšŒì›ê°€ì…</h2>

            {error && (
              <p className="text-red-500 text-sm mb-4 bg-red-50 p-3 rounded-lg">{error}</p>
            )}

            <form onSubmit={handleSubmit} className="space-y-4">
              {/* ì´ë©”ì¼ ì…ë ¥ */}
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-1">ì´ë©”ì¼</label>
                <input
                  type="email"
                  value={email}
                  onChange={(e) => setEmail(e.target.value)}
                  required
                  placeholder="example@email.com"
                  className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:outline-none"
                />
              </div>
              {/* ë¹„ë°€ë²ˆí˜¸ ì…ë ¥ */}
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-1">ë¹„ë°€ë²ˆí˜¸</label>
                {/* ë¹„ë°€ë²ˆí˜¸ ì…ë ¥ + ë³´ê¸°/ìˆ¨ê¸°ê¸° ë²„íŠ¼ì„ ê°ì‹¸ëŠ” ì»¨í…Œì´ë„ˆ */}
                <div className="relative">
                  <input
                    type={showPassword ? "text" : "password"}
                    value={password}
                    onChange={(e) => setPassword(e.target.value)}
                    required
                    placeholder="8ì ì´ìƒ, ëŒ€ë¬¸ì/ìˆ«ì/íŠ¹ìˆ˜ë¬¸ì í¬í•¨"
                    className="w-full px-4 py-2 pr-10 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:outline-none"
                  />
                  {/* ëˆˆ ì•„ì´ì½˜: í´ë¦­í•˜ë©´ ë¹„ë°€ë²ˆí˜¸ ë³´ê¸°/ìˆ¨ê¸°ê¸° í† ê¸€ */}
                  <button
                    type="button"
                    onClick={() => setShowPassword(!showPassword)}
                    className="absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-600"
                  >
                    {showPassword ? (
                      <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.878 9.878L3 3m6.878 6.878L21 21" />
                      </svg>
                    ) : (
                      <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" />
                      </svg>
                    )}
                  </button>
                </div>

                {/* ë¹„ë°€ë²ˆí˜¸ ê·œì¹™ ì•ˆë‚´ (ì‹¤ì‹œê°„ìœ¼ë¡œ ì¶©ì¡± ì—¬ë¶€ í‘œì‹œ) */}
                {/* ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ê¸° ì‹œì‘í•˜ë©´ ê·œì¹™ ëª©ë¡ì´ ë‚˜íƒ€ë‚˜ìš” */}
                <ul className="mt-2 space-y-1">
                  {passwordRules.map((rule, i) => (
                    <li key={i} className={`text-xs flex items-center gap-1.5 ${
                      password.length === 0
                        ? 'text-gray-400'           /* ì…ë ¥ ì „: íšŒìƒ‰ */
                        : rule.met
                          ? 'text-green-500'         /* ì¶©ì¡±: ì´ˆë¡ìƒ‰ */
                          : 'text-red-400'           /* ë¯¸ì¶©ì¡±: ë¹¨ê°„ìƒ‰ */
                    }`}>
                      {/* ì²´í¬/X ì•„ì´ì½˜ */}
                      {password.length > 0 && rule.met ? (
                        <svg className="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                          <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M5 13l4 4L19 7" />
                        </svg>
                      ) : (
                        <svg className="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                          <circle cx="12" cy="12" r="9" strokeWidth={2} />
                        </svg>
                      )}
                      {rule.label}
                    </li>
                  ))}
                </ul>
              </div>
              <button
                type="submit"
                disabled={loading}
                className="w-full bg-primary hover:bg-blue-700 text-white font-bold py-3 rounded-xl transition-colors disabled:opacity-50"
              >
                {loading ? 'ê°€ì… ì¤‘...' : 'íšŒì›ê°€ì…'}
              </button>
            </form>

            {/* ë¡œê·¸ì¸ìœ¼ë¡œ ì „í™˜ ë§í¬ */}
            <p className="text-center text-sm text-gray-500 mt-4">
              ì´ë¯¸ ê³„ì •ì´ ìˆìœ¼ì‹ ê°€ìš”?{' '}
              <button onClick={onSwitchToLogin} className="text-primary font-semibold hover:underline">
                ë¡œê·¸ì¸
              </button>
            </p>
          </div>
        </div>
      );
    }

    // ============================================
    // ğŸ”§ ê´€ë¦¬ì í˜ì´ì§€: ìƒí’ˆ ê´€ë¦¬ + ì£¼ë¬¸ ê´€ë¦¬
    // ============================================
    // ê´€ë¦¬ìë§Œ ì ‘ê·¼í•  ìˆ˜ ìˆëŠ” í˜ì´ì§€ì˜ˆìš”
    // ìƒí’ˆ ë“±ë¡/ìˆ˜ì •/ì‚­ì œ, ì£¼ë¬¸ ì¡°íšŒ/ìƒíƒœ ë³€ê²½ì„ í•  ìˆ˜ ìˆì–´ìš”

    // --- ìƒí’ˆ ë“±ë¡/ìˆ˜ì • í¼ ëª¨ë‹¬ ---
    function BookFormModal({ book, onClose, onSave }) {
      // bookì´ ìˆìœ¼ë©´ ìˆ˜ì • ëª¨ë“œ, ì—†ìœ¼ë©´ ë“±ë¡ ëª¨ë“œ
      const isEdit = !!book;
      const [form, setForm] = React.useState({
        title: book?.title || '',
        author: book?.author || '',
        price: book?.price || '',
        original_price: book?.original_price || '',
        image: book?.image || '',
        category: book?.category || '',
        rating: book?.rating || '',
        description: book?.description || '',
        badge: book?.badge || '',
      });
      const [loading, setLoading] = React.useState(false);
      const [error, setError] = React.useState('');

      // === Google Books ê²€ìƒ‰ ê´€ë ¨ state ===
      const [searchQuery, setSearchQuery] = React.useState('');   // ê²€ìƒ‰ì–´
      const [searchResults, setSearchResults] = React.useState([]); // ê²€ìƒ‰ ê²°ê³¼
      const [searching, setSearching] = React.useState(false);     // ê²€ìƒ‰ ì¤‘ ì—¬ë¶€
      const [searched, setSearched] = React.useState(false);       // ê²€ìƒ‰ ì‹¤í–‰ ì—¬ë¶€

      // ì…ë ¥ê°’ ë³€ê²½ í•¸ë“¤ëŸ¬
      function handleChange(e) {
        setForm({ ...form, [e.target.name]: e.target.value });
      }

      // Google Books ê²€ìƒ‰ í•¨ìˆ˜
      async function handleSearch() {
        if (!searchQuery.trim()) return;
        setSearching(true);
        setSearched(true);
        try {
          const token = localStorage.getItem('token');
          const res = await fetch('/api/admin/books/search?q=' + encodeURIComponent(searchQuery), {
            headers: { 'Authorization': 'Bearer ' + token },
          });
          const data = await res.json();
          if (res.ok) {
            setSearchResults(data.books || []);
          } else {
            setSearchResults([]);
          }
        } catch (err) {
          setSearchResults([]);
        }
        setSearching(false);
      }

      // ê²€ìƒ‰ ê²°ê³¼ í´ë¦­ â†’ í¼ ìë™ ì±„ìš°ê¸°
      function handleSelectBook(result) {
        setForm({
          ...form,
          title: result.title,
          author: result.author,
          description: result.description,
          image: result.image,
          category: result.category,
          rating: result.rating || '',
          // price, original_price, badgeëŠ” ìˆ˜ë™ ì…ë ¥
        });
        setSearchResults([]); // ê²€ìƒ‰ ê²°ê³¼ ë‹«ê¸°
        setSearched(false);
      }

      // ì €ì¥ ë²„íŠ¼ í•¸ë“¤ëŸ¬
      async function handleSubmit(e) {
        e.preventDefault();
        setLoading(true);
        setError('');
        try {
          const token = localStorage.getItem('token');
          const url = isEdit ? '/api/admin/books/' + book.id : '/api/admin/books';
          const method = isEdit ? 'PUT' : 'POST';

          const res = await fetch(url, {
            method,
            headers: {
              'Content-Type': 'application/json',
              'Authorization': 'Bearer ' + token,
            },
            body: JSON.stringify({
              ...form,
              price: parseInt(form.price),
              original_price: parseInt(form.original_price),
              rating: parseFloat(form.rating) || 0,
            }),
          });

          const data = await res.json();
          if (res.ok) {
            onSave(); // ë¶€ëª¨ì—ê²Œ ì €ì¥ ì™„ë£Œ ì•Œë¦¼ (ëª©ë¡ ìƒˆë¡œê³ ì¹¨)
          } else {
            setError(data.error || 'ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤');
          }
        } catch (err) {
          setError('ì„œë²„ ì—°ê²°ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤');
        }
        setLoading(false);
      }

      return (
        <div className="fixed inset-0 z-50 flex items-center justify-center p-4">
          <div className="absolute inset-0 bg-black bg-opacity-50" onClick={onClose} />
          <div className="relative bg-white rounded-2xl shadow-2xl max-w-lg w-full p-6 max-h-[90vh] overflow-y-auto">
            <button onClick={onClose} className="absolute top-4 right-4 text-gray-400 hover:text-gray-600">
              <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12" />
              </svg>
            </button>

            <h2 className="text-xl font-bold text-gray-900 mb-4">
              {isEdit ? 'ìƒí’ˆ ìˆ˜ì •' : 'ìƒˆ ìƒí’ˆ ë“±ë¡'}
            </h2>

            {/* === Google Books ê²€ìƒ‰ ì„¹ì…˜ (ë“±ë¡ ëª¨ë“œì—ì„œë§Œ í‘œì‹œ) === */}
            {!isEdit && (
              <div className="mb-4 p-3 bg-blue-50 rounded-lg">
                <label className="block text-sm font-medium text-primary mb-2">
                  Google Booksì—ì„œ ê²€ìƒ‰í•˜ì—¬ ìë™ ì…ë ¥
                </label>
                <div className="flex gap-2">
                  <input
                    value={searchQuery}
                    onChange={(e) => setSearchQuery(e.target.value)}
                    onKeyDown={(e) => { if (e.key === 'Enter') { e.preventDefault(); handleSearch(); } }}
                    placeholder="ì±… ì œëª© ë˜ëŠ” ì €ì ê²€ìƒ‰..."
                    className="flex-1 px-3 py-2 border rounded-lg focus:ring-2 focus:ring-primary focus:outline-none text-sm"
                  />
                  <button
                    type="button"
                    onClick={handleSearch}
                    disabled={searching}
                    className="bg-primary hover:bg-blue-700 text-white px-4 py-2 rounded-lg text-sm font-medium transition-colors disabled:opacity-50 whitespace-nowrap"
                  >
                    {searching ? 'ê²€ìƒ‰ì¤‘...' : 'ê²€ìƒ‰'}
                  </button>
                </div>

                {/* ê²€ìƒ‰ ê²°ê³¼ ë¦¬ìŠ¤íŠ¸ */}
                {searched && searchResults.length > 0 && (
                  <div className="mt-2 border rounded-lg bg-white max-h-48 overflow-y-auto">
                    {searchResults.map((result, i) => (
                      <button
                        key={i}
                        type="button"
                        onClick={() => handleSelectBook(result)}
                        className="w-full flex items-center gap-3 p-2 hover:bg-gray-50 border-b last:border-b-0 text-left transition-colors"
                      >
                        {result.image && (
                          <img src={result.image} alt="" className="w-10 h-14 object-cover rounded flex-shrink-0" />
                        )}
                        <div className="min-w-0">
                          <p className="text-sm font-medium text-gray-900 truncate">{result.title}</p>
                          <p className="text-xs text-gray-500 truncate">{result.author}</p>
                          <p className="text-xs text-gray-400">{result.category}</p>
                        </div>
                      </button>
                    ))}
                  </div>
                )}
                {searched && !searching && searchResults.length === 0 && (
                  <p className="mt-2 text-xs text-gray-500">ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤</p>
                )}
              </div>
            )}

            {error && <p className="text-red-500 text-sm mb-3 bg-red-50 p-2 rounded">{error}</p>}

            <form onSubmit={handleSubmit} className="space-y-3">
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-1">ì œëª© *</label>
                <input name="title" value={form.title} onChange={handleChange} required
                  className="w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-primary focus:outline-none" />
              </div>
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-1">ì €ì *</label>
                <input name="author" value={form.author} onChange={handleChange} required
                  className="w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-primary focus:outline-none" />
              </div>
              <div className="grid grid-cols-2 gap-3">
                <div>
                  <label className="block text-sm font-medium text-gray-700 mb-1">íŒë§¤ê°€ *</label>
                  <input name="price" type="number" value={form.price} onChange={handleChange} required
                    placeholder="ê°€ê²© ì…ë ¥"
                    className={`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-primary focus:outline-none ${
                      form.title && !form.price ? 'border-red-300 bg-red-50' : ''
                    }`} />
                  {form.title && !form.price && (
                    <p className="text-xs text-red-400 mt-1">ê°€ê²©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”</p>
                  )}
                </div>
                <div>
                  <label className="block text-sm font-medium text-gray-700 mb-1">ì •ê°€ *</label>
                  <input name="original_price" type="number" value={form.original_price} onChange={handleChange} required
                    placeholder="ì •ê°€ ì…ë ¥"
                    className={`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-primary focus:outline-none ${
                      form.title && !form.original_price ? 'border-red-300 bg-red-50' : ''
                    }`} />
                  {form.title && !form.original_price && (
                    <p className="text-xs text-red-400 mt-1">ì •ê°€ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”</p>
                  )}
                </div>
              </div>
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-1">ì¹´í…Œê³ ë¦¬ *</label>
                <input name="category" value={form.category} onChange={handleChange} required placeholder="ì˜ˆ: í”„ë¡œê·¸ë˜ë°, ì†Œì„¤"
                  className="w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-primary focus:outline-none" />
              </div>
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-1">ì´ë¯¸ì§€ URL</label>
                <div className="flex gap-2 items-start">
                  <input name="image" value={form.image} onChange={handleChange} placeholder="https://..."
                    className="flex-1 px-3 py-2 border rounded-lg focus:ring-2 focus:ring-primary focus:outline-none" />
                  {/* ì´ë¯¸ì§€ ë¯¸ë¦¬ë³´ê¸° */}
                  {form.image && (
                    <img src={form.image} alt="ë¯¸ë¦¬ë³´ê¸°" className="w-10 h-14 object-cover rounded border" />
                  )}
                </div>
              </div>
              <div className="grid grid-cols-2 gap-3">
                <div>
                  <label className="block text-sm font-medium text-gray-700 mb-1">í‰ì </label>
                  <input name="rating" type="number" step="0.1" min="0" max="5" value={form.rating} onChange={handleChange}
                    className="w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-primary focus:outline-none" />
                </div>
                <div>
                  <label className="block text-sm font-medium text-gray-700 mb-1">ë°°ì§€</label>
                  <input name="badge" value={form.badge} onChange={handleChange} placeholder="ì˜ˆ: ë² ìŠ¤íŠ¸ì…€ëŸ¬"
                    className="w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-primary focus:outline-none" />
                </div>
              </div>
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-1">ì„¤ëª…</label>
                <textarea name="description" value={form.description} onChange={handleChange} rows={3}
                  className="w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-primary focus:outline-none" />
              </div>
              <button type="submit" disabled={loading}
                className="w-full bg-primary hover:bg-blue-700 text-white font-bold py-3 rounded-xl transition-colors disabled:opacity-50">
                {loading ? 'ì €ì¥ ì¤‘...' : (isEdit ? 'ìˆ˜ì •í•˜ê¸°' : 'ë“±ë¡í•˜ê¸°')}
              </button>
            </form>
          </div>
        </div>
      );
    }

    // --- ê´€ë¦¬ì: ìƒí’ˆ ê´€ë¦¬ íƒ­ ---
    function AdminBooks({ showToast }) {
      const [books, setBooks] = React.useState([]);
      const [loading, setLoading] = React.useState(true);
      const [showForm, setShowForm] = React.useState(false); // ë“±ë¡/ìˆ˜ì • í¼ í‘œì‹œ ì—¬ë¶€
      const [editBook, setEditBook] = React.useState(null);  // ìˆ˜ì •í•  ìƒí’ˆ (nullì´ë©´ ë“±ë¡)
      const [seeding, setSeeding] = React.useState(false);   // Google Books ì‹œë”© ì§„í–‰ ì¤‘

      // ìƒí’ˆ ëª©ë¡ ë¶ˆëŸ¬ì˜¤ê¸° (ë¹„í™œì„± í¬í•¨)
      async function loadBooks() {
        try {
          const token = localStorage.getItem('token');
          const res = await fetch('/api/admin/books', {
            headers: { 'Authorization': 'Bearer ' + token },
          });
          const data = await res.json();
          if (res.ok) setBooks(data.books);
        } catch (err) {
          console.error('ìƒí’ˆ ëª©ë¡ ë¡œë”© ì‹¤íŒ¨:', err);
        }
        setLoading(false);
      }

      React.useEffect(() => { loadBooks(); }, []);

      // Google Booksì—ì„œ ì•½ 50ê¶Œ ìë™ ì‹œë”©
      async function handleSeedGoogleBooks() {
        if (!confirm(
          'âš ï¸ ê¸°ì¡´ ëª¨ë“  ìƒí’ˆì´ ì‚­ì œë˜ê³  Google Booksì—ì„œ ì•½ 50ê¶Œì´ ìƒˆë¡œ ë“±ë¡ë©ë‹ˆë‹¤.\n\nê³„ì†í•˜ì‹œê² ìŠµë‹ˆê¹Œ?'
        )) return;

        setSeeding(true);
        try {
          const token = localStorage.getItem('token');
          const res = await fetch('/api/admin/books/seed-google', {
            method: 'POST',
            headers: { 'Authorization': 'Bearer ' + token },
          });
          const data = await res.json();
          if (res.ok) {
            showToast(data.message);
            loadBooks();
          } else {
            showToast('ì‹œë”© ì‹¤íŒ¨: ' + data.error);
          }
        } catch (err) {
          showToast('ì„œë²„ ì—°ê²°ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤');
        }
        setSeeding(false);
      }

      // ìƒí’ˆ ë¹„í™œì„±í™” (ì‚­ì œ)
      async function handleDelete(book) {
        if (!confirm(`"${book.title}" ìƒí’ˆì„ ë¹„í™œì„±í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) return;
        try {
          const token = localStorage.getItem('token');
          const res = await fetch('/api/admin/books/' + book.id, {
            method: 'DELETE',
            headers: { 'Authorization': 'Bearer ' + token },
          });
          if (res.ok) {
            showToast('ìƒí’ˆì´ ë¹„í™œì„±í™”ë˜ì—ˆìŠµë‹ˆë‹¤');
            loadBooks();
          }
        } catch (err) {
          showToast('ì‚­ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤');
        }
      }

      // ìƒí’ˆ í™œì„±í™” ë³µì›
      async function handleRestore(book) {
        try {
          const token = localStorage.getItem('token');
          const res = await fetch('/api/admin/books/' + book.id, {
            method: 'PUT',
            headers: {
              'Content-Type': 'application/json',
              'Authorization': 'Bearer ' + token,
            },
            body: JSON.stringify({ is_active: true }),
          });
          if (res.ok) {
            showToast('ìƒí’ˆì´ í™œì„±í™”ë˜ì—ˆìŠµë‹ˆë‹¤');
            loadBooks();
          }
        } catch (err) {
          showToast('í™œì„±í™”ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤');
        }
      }

      if (loading) {
        return (
          <div className="text-center py-12">
            <div className="inline-block w-8 h-8 border-4 border-primary border-t-transparent rounded-full animate-spin"></div>
          </div>
        );
      }

      return (
        <div>
          {/* ìƒë‹¨: ì œëª© + ì‹œë”©/ë“±ë¡ ë²„íŠ¼ */}
          <div className="flex items-center justify-between mb-4">
            <h3 className="text-lg font-bold text-gray-900">
              ì „ì²´ ìƒí’ˆ ({books.length}ê°œ)
            </h3>
            <div className="flex gap-2">
              <button
                onClick={handleSeedGoogleBooks}
                disabled={seeding}
                className={`${seeding ? 'bg-gray-400 cursor-not-allowed' : 'bg-orange-500 hover:bg-orange-600'} text-white px-4 py-2 rounded-lg text-sm font-medium transition-colors flex items-center gap-1`}
              >
                {seeding ? (
                  <><div className="w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"></div> ì‹œë”© ì¤‘...</>
                ) : (
                  <><svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" /></svg> Google Books ì‹œë”©</>
                )}
              </button>
              <button
                onClick={() => { setEditBook(null); setShowForm(true); }}
                className="bg-primary hover:bg-blue-700 text-white px-4 py-2 rounded-lg text-sm font-medium transition-colors flex items-center gap-1"
              >
                <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 4v16m8-8H4" /></svg> ìƒˆ ìƒí’ˆ ë“±ë¡
              </button>
            </div>
          </div>

          {/* ìƒí’ˆ í…Œì´ë¸” */}
          <div className="bg-white rounded-xl shadow-sm overflow-hidden">
            <div className="overflow-x-auto">
              <table className="w-full text-sm">
                <thead className="bg-gray-50">
                  <tr>
                    <th className="px-4 py-3 text-left font-medium text-gray-500">ID</th>
                    <th className="px-4 py-3 text-left font-medium text-gray-500">ìƒí’ˆëª…</th>
                    <th className="px-4 py-3 text-left font-medium text-gray-500">ì €ì</th>
                    <th className="px-4 py-3 text-left font-medium text-gray-500">ì¹´í…Œê³ ë¦¬</th>
                    <th className="px-4 py-3 text-right font-medium text-gray-500">íŒë§¤ê°€</th>
                    <th className="px-4 py-3 text-center font-medium text-gray-500">ìƒíƒœ</th>
                    <th className="px-4 py-3 text-center font-medium text-gray-500">ê´€ë¦¬</th>
                  </tr>
                </thead>
                <tbody className="divide-y">
                  {books.map((book) => (
                    <tr key={book.id} className={!book.is_active ? 'bg-gray-50 opacity-60' : ''}>
                      <td className="px-4 py-3 text-gray-500">{book.id}</td>
                      <td className="px-4 py-3 font-medium text-gray-900">{book.title}</td>
                      <td className="px-4 py-3 text-gray-600">{book.author}</td>
                      <td className="px-4 py-3 text-gray-600">{book.category}</td>
                      <td className="px-4 py-3 text-right text-gray-900">{formatPrice(book.price)}</td>
                      <td className="px-4 py-3 text-center">
                        <span className={`px-2 py-1 rounded-full text-xs font-medium ${
                          book.is_active
                            ? 'bg-green-100 text-green-700'
                            : 'bg-gray-100 text-gray-500'
                        }`}>
                          {book.is_active ? 'í™œì„±' : 'ë¹„í™œì„±'}
                        </span>
                      </td>
                      <td className="px-4 py-3 text-center">
                        <div className="flex items-center justify-center gap-2">
                          <button
                            onClick={() => { setEditBook(book); setShowForm(true); }}
                            className="text-primary hover:text-blue-700 text-xs font-medium flex items-center gap-1"
                          >
                            <svg className="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z" /></svg> ìˆ˜ì •
                          </button>
                          {book.is_active ? (
                            <button
                              onClick={() => handleDelete(book)}
                              className="text-red-500 hover:text-red-700 text-xs font-medium flex items-center gap-1"
                            >
                              <svg className="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.878 9.878L3 3m6.878 6.878l4.242 4.242M21 21l-4.88-4.88" /></svg> ë¹„í™œì„±í™”
                            </button>
                          ) : (
                            <button
                              onClick={() => handleRestore(book)}
                              className="text-accent hover:text-green-700 text-xs font-medium flex items-center gap-1"
                            >
                              <svg className="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" /><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" /></svg> í™œì„±í™”
                            </button>
                          )}
                        </div>
                      </td>
                    </tr>
                  ))}
                </tbody>
              </table>
            </div>
          </div>

          {/* ìƒí’ˆ ë“±ë¡/ìˆ˜ì • ëª¨ë‹¬ */}
          {showForm && (
            <BookFormModal
              book={editBook}
              onClose={() => setShowForm(false)}
              onSave={() => {
                setShowForm(false);
                loadBooks();
                showToast(editBook ? 'ìƒí’ˆì´ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤' : 'ìƒˆ ìƒí’ˆì´ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤');
              }}
            />
          )}
        </div>
      );
    }

    // --- ê´€ë¦¬ì: ì£¼ë¬¸ ê´€ë¦¬ íƒ­ ---
    function AdminOrders({ showToast }) {
      const [orders, setOrders] = React.useState([]);
      const [loading, setLoading] = React.useState(true);
      const [pagination, setPagination] = React.useState({ page: 1, totalPages: 1 });
      const [statusFilter, setStatusFilter] = React.useState('');

      // ì£¼ë¬¸ ëª©ë¡ ë¶ˆëŸ¬ì˜¤ê¸°
      async function loadOrders(page = 1) {
        setLoading(true);
        try {
          const token = localStorage.getItem('token');
          let url = '/api/admin/orders?page=' + page + '&limit=20';
          if (statusFilter) url += '&status=' + statusFilter;

          const res = await fetch(url, {
            headers: { 'Authorization': 'Bearer ' + token },
          });
          const data = await res.json();
          if (res.ok) {
            setOrders(data.orders);
            setPagination(data.pagination);
          }
        } catch (err) {
          console.error('ì£¼ë¬¸ ëª©ë¡ ë¡œë”© ì‹¤íŒ¨:', err);
        }
        setLoading(false);
      }

      React.useEffect(() => { loadOrders(); }, [statusFilter]);

      // ì£¼ë¬¸ ìƒíƒœ ë³€ê²½
      async function handleStatusChange(orderId, newStatus) {
        try {
          const token = localStorage.getItem('token');
          const res = await fetch('/api/admin/orders/' + orderId + '/status', {
            method: 'PATCH',
            headers: {
              'Content-Type': 'application/json',
              'Authorization': 'Bearer ' + token,
            },
            body: JSON.stringify({ status: newStatus }),
          });
          if (res.ok) {
            showToast('ì£¼ë¬¸ ìƒíƒœê°€ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤');
            loadOrders(pagination.page);
          }
        } catch (err) {
          showToast('ìƒíƒœ ë³€ê²½ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤');
        }
      }

      // ìƒíƒœë³„ ìƒ‰ìƒ
      const statusColors = {
        READY: 'bg-yellow-100 text-yellow-700',
        DONE: 'bg-blue-100 text-blue-700',
        SHIPPING: 'bg-purple-100 text-purple-700',
        DELIVERED: 'bg-green-100 text-green-700',
        CANCELED: 'bg-red-100 text-red-700',
      };

      // ìƒíƒœ í•œê¸€ ì´ë¦„
      const statusNames = {
        READY: 'ì¤€ë¹„ì¤‘', DONE: 'ê²°ì œì™„ë£Œ', SHIPPING: 'ë°°ì†¡ì¤‘',
        DELIVERED: 'ë°°ì†¡ì™„ë£Œ', CANCELED: 'ì·¨ì†Œë¨',
      };

      return (
        <div>
          {/* ìƒíƒœ í•„í„° */}
          <div className="flex items-center gap-2 mb-4">
            <span className="text-sm text-gray-600">ìƒíƒœ í•„í„°:</span>
            <select
              value={statusFilter}
              onChange={(e) => setStatusFilter(e.target.value)}
              className="px-3 py-1.5 border rounded-lg text-sm focus:ring-2 focus:ring-primary focus:outline-none"
            >
              <option value="">ì „ì²´</option>
              <option value="READY">ì¤€ë¹„ì¤‘</option>
              <option value="DONE">ê²°ì œì™„ë£Œ</option>
              <option value="SHIPPING">ë°°ì†¡ì¤‘</option>
              <option value="DELIVERED">ë°°ì†¡ì™„ë£Œ</option>
              <option value="CANCELED">ì·¨ì†Œë¨</option>
            </select>
            {pagination.totalCount !== undefined && (
              <span className="text-sm text-gray-500 ml-2">
                ì´ {pagination.totalCount}ê±´
              </span>
            )}
          </div>

          {loading ? (
            <div className="text-center py-12">
              <div className="inline-block w-8 h-8 border-4 border-primary border-t-transparent rounded-full animate-spin"></div>
            </div>
          ) : orders.length === 0 ? (
            <div className="text-center py-12 text-gray-500">ì£¼ë¬¸ì´ ì—†ìŠµë‹ˆë‹¤</div>
          ) : (
            <div className="bg-white rounded-xl shadow-sm overflow-hidden">
              <div className="overflow-x-auto">
                <table className="w-full text-sm">
                  <thead className="bg-gray-50">
                    <tr>
                      <th className="px-4 py-3 text-left font-medium text-gray-500">ì£¼ë¬¸ë²ˆí˜¸</th>
                      <th className="px-4 py-3 text-left font-medium text-gray-500">ê³ ê°</th>
                      <th className="px-4 py-3 text-left font-medium text-gray-500">ì£¼ë¬¸ëª…</th>
                      <th className="px-4 py-3 text-right font-medium text-gray-500">ê¸ˆì•¡</th>
                      <th className="px-4 py-3 text-center font-medium text-gray-500">ìƒíƒœ</th>
                      <th className="px-4 py-3 text-left font-medium text-gray-500">ì£¼ë¬¸ì¼ì‹œ</th>
                      <th className="px-4 py-3 text-center font-medium text-gray-500">ìƒíƒœ ë³€ê²½</th>
                    </tr>
                  </thead>
                  <tbody className="divide-y">
                    {orders.map((order) => (
                      <tr key={order.id}>
                        <td className="px-4 py-3 text-gray-500 text-xs">{order.order_id}</td>
                        <td className="px-4 py-3 text-gray-700">{order.user_email}</td>
                        <td className="px-4 py-3 text-gray-900 font-medium">{order.order_name}</td>
                        <td className="px-4 py-3 text-right text-gray-900">{formatPrice(order.total_amount)}</td>
                        <td className="px-4 py-3 text-center">
                          <span className={`px-2 py-1 rounded-full text-xs font-medium ${statusColors[order.status] || 'bg-gray-100'}`}>
                            {statusNames[order.status] || order.status}
                          </span>
                        </td>
                        <td className="px-4 py-3 text-gray-500 text-xs">
                          {new Date(order.created_at).toLocaleString('ko-KR')}
                        </td>
                        <td className="px-4 py-3 text-center">
                          <select
                            value={order.status}
                            onChange={(e) => handleStatusChange(order.id, e.target.value)}
                            className="px-2 py-1 border rounded text-xs focus:ring-2 focus:ring-primary focus:outline-none"
                          >
                            <option value="READY">ì¤€ë¹„ì¤‘</option>
                            <option value="DONE">ê²°ì œì™„ë£Œ</option>
                            <option value="SHIPPING">ë°°ì†¡ì¤‘</option>
                            <option value="DELIVERED">ë°°ì†¡ì™„ë£Œ</option>
                            <option value="CANCELED">ì·¨ì†Œë¨</option>
                          </select>
                        </td>
                      </tr>
                    ))}
                  </tbody>
                </table>
              </div>

              {/* í˜ì´ì§€ë„¤ì´ì…˜ */}
              {pagination.totalPages > 1 && (
                <div className="flex items-center justify-center gap-2 p-4 border-t">
                  <button
                    onClick={() => loadOrders(pagination.page - 1)}
                    disabled={pagination.page <= 1}
                    className="px-3 py-1 border rounded text-sm disabled:opacity-30 hover:bg-gray-50"
                  >
                    ì´ì „
                  </button>
                  <span className="text-sm text-gray-600">
                    {pagination.page} / {pagination.totalPages}
                  </span>
                  <button
                    onClick={() => loadOrders(pagination.page + 1)}
                    disabled={pagination.page >= pagination.totalPages}
                    className="px-3 py-1 border rounded text-sm disabled:opacity-30 hover:bg-gray-50"
                  >
                    ë‹¤ìŒ
                  </button>
                </div>
              )}
            </div>
          )}
        </div>
      );
    }

    // --- ê´€ë¦¬ì ë©”ì¸ í˜ì´ì§€ (íƒ­ ë„¤ë¹„ê²Œì´ì…˜) ---
    function AdminPage({ onBack, showToast }) {
      const [activeTab, setActiveTab] = React.useState('books'); // 'books' ë˜ëŠ” 'orders'

      return (
        <div className="min-h-screen bg-gray-50">
          {/* ê´€ë¦¬ì í—¤ë” */}
          <header className="bg-white shadow-sm sticky top-0 z-40">
            <div className="max-w-7xl mx-auto px-4 py-4 flex items-center gap-4">
              <button onClick={onBack} className="text-gray-600 hover:text-gray-900 transition-colors">
                <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 19l-7-7 7-7" />
                </svg>
              </button>
              <h1 className="text-xl font-bold text-gray-900">ê´€ë¦¬ì í˜ì´ì§€</h1>
            </div>
            {/* íƒ­ */}
            <div className="max-w-7xl mx-auto px-4">
              <div className="flex border-b">
                <button
                  onClick={() => setActiveTab('books')}
                  className={`px-6 py-3 text-sm font-medium border-b-2 transition-colors ${
                    activeTab === 'books'
                      ? 'border-primary text-primary'
                      : 'border-transparent text-gray-500 hover:text-gray-700'
                  }`}
                >
                  ìƒí’ˆ ê´€ë¦¬
                </button>
                <button
                  onClick={() => setActiveTab('orders')}
                  className={`px-6 py-3 text-sm font-medium border-b-2 transition-colors ${
                    activeTab === 'orders'
                      ? 'border-primary text-primary'
                      : 'border-transparent text-gray-500 hover:text-gray-700'
                  }`}
                >
                  ì£¼ë¬¸ ê´€ë¦¬
                </button>
              </div>
            </div>
          </header>

          {/* íƒ­ ë‚´ìš© */}
          <main className="max-w-7xl mx-auto px-4 py-6">
            {activeTab === 'books' ? (
              <AdminBooks showToast={showToast} />
            ) : (
              <AdminOrders showToast={showToast} />
            )}
          </main>
        </div>
      );
    }

    // ============================================
    // ğŸ  9ë‹¨ê³„: ë©”ì¸ App ì»´í¬ë„ŒíŠ¸
    // ============================================
    // ëª¨ë“  ê²ƒì„ í•˜ë‚˜ë¡œ í•©ì¹˜ëŠ” ìµœìƒìœ„ ì»´í¬ë„ŒíŠ¸
    function App() {
      // --- React ìƒíƒœ(state) ê´€ë¦¬ ---
      // state = ì»´í¬ë„ŒíŠ¸ê°€ ê¸°ì–µí•˜ëŠ” ë°ì´í„°. ê°’ì´ ë°”ë€Œë©´ í™”ë©´ì´ ìë™ìœ¼ë¡œ ë‹¤ì‹œ ê·¸ë ¤ì ¸ìš”.

      // === ìƒí’ˆ ë°ì´í„° (ì„œë²„ì—ì„œ ë¡œë”©) ===
      const [books, setBooks] = React.useState([]);
      // books: ì„œë²„ APIì—ì„œ ë¶ˆëŸ¬ì˜¨ ì±… ëª©ë¡
      const [booksLoading, setBooksLoading] = React.useState(true);
      // booksLoading: ì±… ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì¸ì§€

      const [cart, setCart] = React.useState([]);
      // cart: ì¥ë°”êµ¬ë‹ˆì— ë‹´ê¸´ ì±… ëª©ë¡ (ë°°ì—´)
      // setCart: cart ê°’ì„ ë°”ê¾¸ëŠ” í•¨ìˆ˜

      const [isCartOpen, setIsCartOpen] = React.useState(false);
      // isCartOpen: ì¥ë°”êµ¬ë‹ˆ íŒ¨ë„ì´ ì—´ë ¤ìˆëŠ”ì§€ (true/false)

      const [selectedCategory, setSelectedCategory] = React.useState("ì „ì²´");
      // selectedCategory: í˜„ì¬ ì„ íƒëœ ì¹´í…Œê³ ë¦¬

      const [searchQuery, setSearchQuery] = React.useState("");
      // searchQuery: ê²€ìƒ‰ì°½ì— ì…ë ¥ëœ í…ìŠ¤íŠ¸

      const [selectedBook, setSelectedBook] = React.useState(null);
      // selectedBook: ìƒì„¸ë³´ê¸°ë¡œ ì„ íƒëœ ì±… (ì—†ìœ¼ë©´ null)

      const [toast, setToast] = React.useState(null);
      // toast: ì•Œë¦¼ ë©”ì‹œì§€ (ì˜ˆ: "ì¥ë°”êµ¬ë‹ˆì— ë‹´ì•˜ìŠµë‹ˆë‹¤")

      // === ì¸ì¦(ë¡œê·¸ì¸) ê´€ë ¨ ìƒíƒœ ===
      const [user, setUser] = React.useState(null);
      // user: ë¡œê·¸ì¸ëœ ì‚¬ìš©ì ì •ë³´ (nullì´ë©´ ë¹„ë¡œê·¸ì¸ ìƒíƒœ)
      // user.role: 'user' ë˜ëŠ” 'admin' (ê´€ë¦¬ì ì—¬ë¶€)

      const [showLogin, setShowLogin] = React.useState(false);
      // showLogin: ë¡œê·¸ì¸ ëª¨ë‹¬ì„ ë³´ì—¬ì¤„ì§€ ì—¬ë¶€

      const [showRegister, setShowRegister] = React.useState(false);
      // showRegister: íšŒì›ê°€ì… ëª¨ë‹¬ì„ ë³´ì—¬ì¤„ì§€ ì—¬ë¶€

      // === ê²°ì œ ê´€ë ¨ ìƒíƒœ ===
      const [currentPage, setCurrentPage] = React.useState('home');
      // currentPage: í˜„ì¬ í‘œì‹œ ì¤‘ì¸ í˜ì´ì§€
      // 'home' = ë©”ì¸ í˜ì´ì§€, 'checkout' = ê²°ì œ í˜ì´ì§€, 'success' = ì„±ê³µ, 'fail' = ì‹¤íŒ¨
      // 'admin' = ê´€ë¦¬ì í˜ì´ì§€ (ê´€ë¦¬ìë§Œ ì ‘ê·¼ ê°€ëŠ¥)

      const [paymentResult, setPaymentResult] = React.useState(null);
      // paymentResult: ê²°ì œ ìŠ¹ì¸ ê²°ê³¼ ë°ì´í„° (ì„±ê³µ/ì‹¤íŒ¨ í˜ì´ì§€ì—ì„œ ì‚¬ìš©)

      // === í˜ì´ì§€ ë¡œë“œ ì‹œ ìë™ ë¡œê·¸ì¸ í™•ì¸ ===
      // useEffect: ì»´í¬ë„ŒíŠ¸ê°€ ì²˜ìŒ í™”ë©´ì— ë‚˜íƒ€ë‚  ë•Œ í•œ ë²ˆ ì‹¤í–‰ë˜ëŠ” í•¨ìˆ˜
      // (ë¹ˆ ë°°ì—´ []ì„ ë„£ìœ¼ë©´ "ì²˜ìŒ í•œ ë²ˆë§Œ" ì‹¤í–‰)
      React.useEffect(() => {
        const token = localStorage.getItem('token');
        if (token) {
          // í† í°ì´ ìˆìœ¼ë©´ â†’ ì„œë²„ì— "ì´ í† í° ì•„ì§ ìœ íš¨í•´?" í™•ì¸
          fetch('/api/me', {
            headers: { 'Authorization': 'Bearer ' + token }
          })
          .then(res => res.json())
          .then(data => {
            if (data.user) {
              setUser(data.user); // ìœ íš¨í•˜ë©´ â†’ ë¡œê·¸ì¸ ìƒíƒœë¡œ ì„¤ì •
            } else {
              localStorage.removeItem('token'); // ë¬´íš¨í•˜ë©´ â†’ í† í° ì‚­ì œ
            }
          })
          .catch(() => localStorage.removeItem('token'));
        }
      }, []);

      // === ì„œë²„ì—ì„œ ìƒí’ˆ ë°ì´í„° ë¡œë”© ===
      // ì»´í¬ë„ŒíŠ¸ê°€ ì²˜ìŒ ë‚˜íƒ€ë‚  ë•Œ /api/books APIë¥¼ í˜¸ì¶œí•´ì„œ ì±… ëª©ë¡ì„ ê°€ì ¸ì™€ìš”
      React.useEffect(() => {
        fetch('/api/books')
          .then(res => res.json())
          .then(data => {
            if (data.books) {
              setBooks(data.books);
            }
          })
          .catch(err => console.error('ìƒí’ˆ ë¡œë”© ì‹¤íŒ¨:', err))
          .finally(() => setBooksLoading(false));
      }, []);

      // ì¹´í…Œê³ ë¦¬ ëª©ë¡ì„ books ë°ì´í„°ì—ì„œ ë™ì ìœ¼ë¡œ ìƒì„±
      // booksê°€ ë°”ë€” ë•Œë§ˆë‹¤ ìë™ìœ¼ë¡œ ë‹¤ì‹œ ê³„ì‚°ë¼ìš” (useMemo)
      const categories = React.useMemo(() => {
        const cats = [...new Set(books.map(b => b.category))]; // ì¤‘ë³µ ì œê±°
        return ['ì „ì²´', ...cats];
      }, [books]);

      // === ê²°ì œ ê²°ê³¼ URL ê°ì§€ ===
      // í† ìŠ¤í˜ì´ë¨¼ì¸  ê²°ì œê°€ ì™„ë£Œë˜ë©´ /success ë˜ëŠ” /failë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸ë¼ìš”
      // ì´ useEffectê°€ URLì„ ê°ì§€í•´ì„œ ì ì ˆí•œ í˜ì´ì§€ë¥¼ ë³´ì—¬ì¤ë‹ˆë‹¤
      React.useEffect(() => {
        const pathname = window.location.pathname;
        const urlParams = new URLSearchParams(window.location.search);

        if (pathname === '/success') {
          // ê²°ì œ ì„±ê³µ ë¦¬ë‹¤ì´ë ‰íŠ¸ ê°ì§€!
          setCurrentPage('success');
          // URLì—ì„œ ê²°ì œ ì •ë³´ ì¶”ì¶œ
          const paymentKey = urlParams.get('paymentKey');
          const orderId = urlParams.get('orderId');
          const amount = urlParams.get('amount');

          if (paymentKey && orderId && amount) {
            // ì„œë²„ì— ê²°ì œ ìŠ¹ì¸ ìš”ì²­ ë³´ë‚´ê¸°
            confirmPayment(paymentKey, orderId, parseInt(amount));
          }
        } else if (pathname === '/fail') {
          // ê²°ì œ ì‹¤íŒ¨ ë¦¬ë‹¤ì´ë ‰íŠ¸ ê°ì§€
          setCurrentPage('fail');
          setPaymentResult({
            success: false,
            code: urlParams.get('code'),
            message: urlParams.get('message'),
          });
        }
      }, []);

      // === ê²°ì œ ìŠ¹ì¸ ìš”ì²­ í•¨ìˆ˜ ===
      // í† ìŠ¤í˜ì´ë¨¼ì¸  ë¦¬ë‹¤ì´ë ‰íŠ¸ í›„ ì„œë²„ì— ê²°ì œë¥¼ "í™•ì •"í•˜ëŠ” ìš”ì²­ì„ ë³´ë‚´ìš”
      // ì´ ë‹¨ê³„ê°€ ìˆì–´ì•¼ ì‹¤ì œë¡œ ê²°ì œê°€ ì™„ë£Œë©ë‹ˆë‹¤!
      async function confirmPayment(paymentKey, orderId, amount) {
        try {
          const token = localStorage.getItem('token');
          const response = await fetch('/api/payments/confirm', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
              'Authorization': 'Bearer ' + token,
            },
            body: JSON.stringify({
              paymentKey,
              orderId,
              amount,
              // ì¥ë°”êµ¬ë‹ˆ ìƒí’ˆ ì •ë³´ë„ í•¨ê»˜ ì „ë‹¬ (DBì— ì €ì¥ìš©)
              items: cart.map(item => ({
                bookId: item.id,
                title: item.title,
                author: item.author,
                price: item.price,
                quantity: item.quantity,
              })),
            }),
          });

          const data = await response.json();

          if (response.ok) {
            // ê²°ì œ ìŠ¹ì¸ ì„±ê³µ!
            setPaymentResult({ success: true, data });
            setCart([]); // ì¥ë°”êµ¬ë‹ˆ ë¹„ìš°ê¸°
          } else {
            // ê²°ì œ ìŠ¹ì¸ ì‹¤íŒ¨
            setPaymentResult({
              success: false,
              code: data.code || 'CONFIRM_ERROR',
              message: data.message || 'ê²°ì œ ìŠ¹ì¸ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤',
            });
          }
        } catch (error) {
          setPaymentResult({
            success: false,
            code: 'NETWORK_ERROR',
            message: 'ì„œë²„ ì—°ê²°ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤',
          });
        }
      }

      // === ì£¼ë¬¸í•˜ê¸° ë²„íŠ¼ í•¸ë“¤ëŸ¬ ===
      // ì¥ë°”êµ¬ë‹ˆì˜ "ì£¼ë¬¸í•˜ê¸°" ë²„íŠ¼ì„ ëˆ„ë¥´ë©´ ì‹¤í–‰ë¼ìš”
      function handleCheckout() {
        // ë¡œê·¸ì¸ í™•ì¸: ê²°ì œí•˜ë ¤ë©´ ë°˜ë“œì‹œ ë¡œê·¸ì¸í•´ì•¼ í•´ìš”
        if (!user) {
          setIsCartOpen(false);
          setShowLogin(true);
          showToast('ì£¼ë¬¸í•˜ë ¤ë©´ ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤');
          return;
        }
        // ì¥ë°”êµ¬ë‹ˆê°€ ë¹„ì–´ìˆìœ¼ë©´ ì•„ë¬´ê²ƒë„ ì•ˆ í•¨
        if (cart.length === 0) return;
        // ì¥ë°”êµ¬ë‹ˆ íŒ¨ë„ ë‹«ê³  ê²°ì œ í˜ì´ì§€ë¡œ ì´ë™
        setIsCartOpen(false);
        setCurrentPage('checkout');
      }

      // === ë¡œê·¸ì•„ì›ƒ í•¨ìˆ˜ ===
      function handleLogout() {
        localStorage.removeItem('token'); // ì €ì¥ëœ í† í° ì‚­ì œ
        setUser(null);                     // ì‚¬ìš©ì ì •ë³´ ì´ˆê¸°í™”
        setCurrentPage('home');            // ê´€ë¦¬ì í˜ì´ì§€ì—ì„œ ë‚˜ê°€ê¸°
        showToast('ë¡œê·¸ì•„ì›ƒ ë˜ì—ˆìŠµë‹ˆë‹¤');
      }

      // --- ì±… í•„í„°ë§ ë¡œì§ ---
      // ì¹´í…Œê³ ë¦¬ì™€ ê²€ìƒ‰ì–´ì— ë§ëŠ” ì±…ë§Œ ê³¨ë¼ë‚´ê¸°
      const filteredBooks = books.filter((book) => {
        // 1. ì¹´í…Œê³ ë¦¬ í•„í„°: "ì „ì²´"ì´ë©´ í†µê³¼, ì•„ë‹ˆë©´ ê°™ì€ ì¹´í…Œê³ ë¦¬ë§Œ
        const matchesCategory =
          selectedCategory === "ì „ì²´" || book.category === selectedCategory;

        // 2. ê²€ìƒ‰ í•„í„°: ì œëª©ì´ë‚˜ ì €ìì— ê²€ìƒ‰ì–´ê°€ í¬í•¨ë˜ì–´ ìˆëŠ”ì§€ í™•ì¸
        const matchesSearch =
          book.title.toLowerCase().includes(searchQuery.toLowerCase()) ||
          book.author.toLowerCase().includes(searchQuery.toLowerCase());

        // ë‘˜ ë‹¤ ë§Œì¡±í•´ì•¼ í‘œì‹œ
        return matchesCategory && matchesSearch;
      });

      // --- ì¥ë°”êµ¬ë‹ˆ ë‹´ê¸° í•¨ìˆ˜ ---
      function addToCart(book) {
        setCart((prevCart) => {
          // ì´ë¯¸ ì¥ë°”êµ¬ë‹ˆì— ê°™ì€ ì±…ì´ ìˆëŠ”ì§€ í™•ì¸
          const existingItem = prevCart.find((item) => item.id === book.id);

          if (existingItem) {
            // ì´ë¯¸ ìˆìœ¼ë©´ â†’ ìˆ˜ëŸ‰ë§Œ 1 ì¦ê°€
            return prevCart.map((item) =>
              item.id === book.id
                ? { ...item, quantity: item.quantity + 1 }
                : item
            );
          } else {
            // ì—†ìœ¼ë©´ â†’ ìƒˆë¡œ ì¶”ê°€ (ìˆ˜ëŸ‰ 1ë¡œ ì‹œì‘)
            return [...prevCart, { ...book, quantity: 1 }];
          }
        });

        // í† ìŠ¤íŠ¸ ì•Œë¦¼ í‘œì‹œ
        showToast(`"${book.title}" ì„(ë¥¼) ì¥ë°”êµ¬ë‹ˆì— ë‹´ì•˜ìŠµë‹ˆë‹¤!`);
      }

      // --- ìˆ˜ëŸ‰ ë³€ê²½ í•¨ìˆ˜ ---
      function updateQuantity(bookId, newQuantity) {
        if (newQuantity <= 0) {
          // ìˆ˜ëŸ‰ì´ 0 ì´í•˜ë©´ â†’ ì¥ë°”êµ¬ë‹ˆì—ì„œ ì œê±°
          removeFromCart(bookId);
          return;
        }
        setCart((prevCart) =>
          prevCart.map((item) =>
            item.id === bookId ? { ...item, quantity: newQuantity } : item
          )
        );
      }

      // --- ì¥ë°”êµ¬ë‹ˆì—ì„œ ì œê±° í•¨ìˆ˜ ---
      function removeFromCart(bookId) {
        setCart((prevCart) => prevCart.filter((item) => item.id !== bookId));
      }

      // --- í† ìŠ¤íŠ¸ ì•Œë¦¼ í‘œì‹œ í•¨ìˆ˜ ---
      function showToast(message) {
        setToast(message);
        // 2ì´ˆ í›„ ìë™ìœ¼ë¡œ ì‚¬ë¼ì§
        setTimeout(() => setToast(null), 2000);
      }

      // ì¥ë°”êµ¬ë‹ˆ ì´ ìˆ˜ëŸ‰ (í—¤ë” ë±ƒì§€ì— í‘œì‹œ)
      const cartItemCount = cart.reduce((sum, item) => sum + item.quantity, 0);

      // --- í™”ë©´ ë Œë”ë§ ---
      // currentPageì— ë”°ë¼ ë‹¤ë¥¸ í˜ì´ì§€ë¥¼ ë³´ì—¬ì¤˜ìš”
      // 'checkout' â†’ ê²°ì œ í˜ì´ì§€, 'success' â†’ ì„±ê³µ í˜ì´ì§€, 'fail' â†’ ì‹¤íŒ¨ í˜ì´ì§€
      // 'admin' â†’ ê´€ë¦¬ì í˜ì´ì§€ (ìƒí’ˆ ê´€ë¦¬ + ì£¼ë¬¸ ê´€ë¦¬)
      if (currentPage === 'admin' && user?.role === 'admin') {
        return (
          <AdminPage
            onBack={() => {
              setCurrentPage('home');
              // ê´€ë¦¬ìê°€ ìƒí’ˆì„ ë³€ê²½í–ˆì„ ìˆ˜ ìˆìœ¼ë‹ˆ ëª©ë¡ ìƒˆë¡œê³ ì¹¨
              fetch('/api/books')
                .then(res => res.json())
                .then(data => { if (data.books) setBooks(data.books); })
                .catch(() => {});
            }}
            showToast={showToast}
          />
        );
      }

      if (currentPage === 'checkout') {
        return (
          <CheckoutPage
            cart={cart}
            user={user}
            onBack={() => setCurrentPage('home')}
            showToast={showToast}
          />
        );
      }

      if (currentPage === 'success') {
        return (
          <SuccessPage
            result={paymentResult}
            onGoHome={() => {
              setCurrentPage('home');
              setPaymentResult(null);
            }}
          />
        );
      }

      if (currentPage === 'fail') {
        return (
          <FailPage
            result={paymentResult}
            onGoHome={() => {
              setCurrentPage('home');
              setPaymentResult(null);
            }}
          />
        );
      }

      // currentPage === 'home' â†’ ê¸°ì¡´ ë©”ì¸ í˜ì´ì§€
      return (
        <div className="min-h-screen bg-gray-50">
          {/* min-h-screen: ìµœì†Œ ë†’ì´ë¥¼ í™”ë©´ ì „ì²´ë¡œ (ë‚´ìš©ì´ ì ì–´ë„ ë°°ê²½ì´ ê½‰ ì°¸) */}
          {/* bg-gray-50: ì•„ì£¼ ì—°í•œ íšŒìƒ‰ ë°°ê²½ */}

          {/* ========== í—¤ë” (ìƒë‹¨ ë„¤ë¹„ê²Œì´ì…˜ ë°”) ========== */}
          <header className="bg-white shadow-sm sticky top-0 z-40">
            {/* sticky top-0: ìŠ¤í¬ë¡¤í•´ë„ í™”ë©´ ìƒë‹¨ì— ë¶™ì–´ìˆìŒ */}
            {/* z-40: ë‹¤ë¥¸ ì½˜í…ì¸ ë³´ë‹¤ ìœ„ì— í‘œì‹œ */}
            <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
              {/* max-w-7xl: ìµœëŒ€ ë„ˆë¹„ ì œí•œ (ë„ˆë¬´ ë„“ì€ í™”ë©´ì—ì„œ ê°€ìš´ë° ì •ë ¬) */}
              {/* mx-auto: ì¢Œìš° ë§ˆì§„ ìë™ â†’ ê°€ìš´ë° ì •ë ¬ */}
              <div className="flex items-center justify-between h-16">

                {/* ë¡œê³  */}
                <div className="flex items-center gap-2">
                  <svg className="w-8 h-8 text-primary" fill="currentColor" viewBox="0 0 24 24">
                    <path d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253" />
                  </svg>
                  <h1 className="text-xl font-bold text-gray-900">
                    ë¶<span className="text-primary">ìƒµ</span>
                  </h1>
                </div>

                {/* ê²€ìƒ‰ë°” */}
                <div className="flex-1 max-w-lg mx-8 hidden sm:block">
                  {/* hidden sm:block: ì‘ì€ í™”ë©´ì—ì„œëŠ” ìˆ¨ê¸°ê³ , sm(640px) ì´ìƒì—ì„œ í‘œì‹œ */}
                  <div className="relative">
                    {/* ë‹ë³´ê¸° ì•„ì´ì½˜ */}
                    <svg className="absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                    </svg>
                    {/* ê²€ìƒ‰ ì…ë ¥ì°½ */}
                    <input
                      type="text"
                      placeholder="ì±… ì œëª©, ì €ìë¡œ ê²€ìƒ‰..."
                      value={searchQuery}
                      onChange={(e) => setSearchQuery(e.target.value)}
                      className="w-full pl-10 pr-4 py-2 rounded-full border border-gray-300 focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent bg-gray-50"
                      /* pl-10: ì™¼ìª½ ì•ˆìª½ ì—¬ë°± 40px (ë‹ë³´ê¸° ì•„ì´ì½˜ ê³µê°„ í™•ë³´) */
                      /* rounded-full: ì™„ì „í•œ ë‘¥ê·¼ ëª¨ì„œë¦¬ (ì•Œì•½ ëª¨ì–‘) */
                      /* focus:ring-2: í´ë¦­(í¬ì»¤ìŠ¤)í•˜ë©´ íŒŒë€ìƒ‰ í…Œë‘ë¦¬ ê°•ì¡° */
                    />
                  </div>
                </div>

                {/* ===== ë¡œê·¸ì¸/ì‚¬ìš©ì ì •ë³´ + ì¥ë°”êµ¬ë‹ˆ ì˜ì—­ ===== */}
                <div className="flex items-center gap-3">
                  {user ? (
                    /* ë¡œê·¸ì¸ ë˜ì—ˆì„ ë•Œ: ì‚¬ìš©ì ì´ë¦„ + ë¡œê·¸ì•„ì›ƒ ë²„íŠ¼ */
                    <div className="flex items-center gap-2">
                      {/* ì‚¬ìš©ì ì•„ì´ì½˜ */}
                      <svg className="w-5 h-5 text-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
                      </svg>
                      <span className="text-sm font-medium text-gray-700 hidden sm:block">
                        {user.email}ë‹˜
                      </span>
                      {/* ê´€ë¦¬ì ë²„íŠ¼: roleì´ 'admin'ì¸ ê²½ìš°ì—ë§Œ í‘œì‹œ */}
                      {user.role === 'admin' && (
                        <button
                          onClick={() => setCurrentPage('admin')}
                          className="text-sm bg-gray-800 text-white px-3 py-1.5 rounded-lg hover:bg-gray-900 transition-colors"
                        >
                          ê´€ë¦¬ì
                        </button>
                      )}
                      <button
                        onClick={handleLogout}
                        className="text-sm text-gray-500 hover:text-gray-700 transition-colors"
                      >
                        ë¡œê·¸ì•„ì›ƒ
                      </button>
                    </div>
                  ) : (
                    /* ë¡œê·¸ì¸ ì•ˆ ë˜ì—ˆì„ ë•Œ: ë¡œê·¸ì¸/íšŒì›ê°€ì… ë²„íŠ¼ */
                    <div className="flex items-center gap-2">
                      <button
                        onClick={() => setShowLogin(true)}
                        className="text-sm font-medium text-gray-600 hover:text-primary transition-colors"
                      >
                        ë¡œê·¸ì¸
                      </button>
                      <button
                        onClick={() => setShowRegister(true)}
                        className="text-sm bg-primary text-white px-3 py-1.5 rounded-lg hover:bg-blue-700 transition-colors"
                      >
                        íšŒì›ê°€ì…
                      </button>
                    </div>
                  )}

                  {/* ì¥ë°”êµ¬ë‹ˆ ë²„íŠ¼ */}
                  <button
                    onClick={() => setIsCartOpen(true)}
                    className="relative p-2 text-gray-600 hover:text-primary transition-colors"
                  >
                    <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 100 4 2 2 0 000-4z" />
                    </svg>
                    {cartItemCount > 0 && (
                      <span className="absolute -top-1 -right-1 bg-red-500 text-white text-xs font-bold w-5 h-5 rounded-full flex items-center justify-center">
                        {cartItemCount}
                      </span>
                    )}
                  </button>
                </div>
              </div>

              {/* ëª¨ë°”ì¼ìš© ê²€ìƒ‰ë°” (ì‘ì€ í™”ë©´ì—ì„œë§Œ í‘œì‹œ) */}
              <div className="sm:hidden pb-3">
                <div className="relative">
                  <svg className="absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                  </svg>
                  <input
                    type="text"
                    placeholder="ì±… ì œëª©, ì €ìë¡œ ê²€ìƒ‰..."
                    value={searchQuery}
                    onChange={(e) => setSearchQuery(e.target.value)}
                    className="w-full pl-10 pr-4 py-2 rounded-full border border-gray-300 focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent bg-gray-50"
                  />
                </div>
              </div>
            </div>
          </header>

          {/* ========== íˆì–´ë¡œ ë°°ë„ˆ (ë©”ì¸ ì´ë¯¸ì§€ ì˜ì—­) ========== */}
          <section className="bg-gradient-to-r from-blue-600 to-indigo-700 text-white">
            {/* bg-gradient-to-r: ì™¼ìª½â†’ì˜¤ë¥¸ìª½ìœ¼ë¡œ ê·¸ë¼ë°ì´ì…˜ ë°°ê²½ */}
            <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12 sm:py-16">
              <div className="text-center">
                <h2 className="text-3xl sm:text-4xl font-extrabold">
                  ë‹¹ì‹ ì˜ ë‹¤ìŒ ì±…ì„ ë§Œë‚˜ë³´ì„¸ìš”
                </h2>
                <p className="mt-4 text-lg text-blue-100 max-w-2xl mx-auto">
                  ë² ìŠ¤íŠ¸ì…€ëŸ¬ë¶€í„° ìˆ¨ê²¨ì§„ ëª…ì‘ê¹Œì§€, ë‹¤ì–‘í•œ ì±…ì„ ë§Œë‚˜ë³¼ ìˆ˜ ìˆëŠ” ê³³
                </p>
                <div className="mt-6 flex justify-center gap-4">
                  <span className="bg-white bg-opacity-20 px-4 py-2 rounded-full text-sm">
                    3ë§Œì› ì´ìƒ ë¬´ë£Œë°°ì†¡
                  </span>
                  <span className="bg-white bg-opacity-20 px-4 py-2 rounded-full text-sm">
                    ìµœëŒ€ 10% í• ì¸
                  </span>
                </div>
              </div>
            </div>
          </section>

          {/* ========== ë©”ì¸ ì½˜í…ì¸  ì˜ì—­ ========== */}
          <main className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">

            {/* ì¹´í…Œê³ ë¦¬ í•„í„° ë²„íŠ¼ë“¤ */}
            <div className="flex flex-wrap gap-2 mb-8">
              {/* flex-wrap: ë²„íŠ¼ì´ ë§ìœ¼ë©´ ìë™ìœ¼ë¡œ ë‹¤ìŒ ì¤„ë¡œ */}
              {/* gap-2: ë²„íŠ¼ ì‚¬ì´ ê°„ê²© 8px */}
              {categories.map((category) => (
                <button
                  key={category}
                  onClick={() => setSelectedCategory(category)}
                  className={`px-4 py-2 rounded-full text-sm font-medium transition-colors duration-200 ${
                    /* ì„ íƒëœ ì¹´í…Œê³ ë¦¬ëŠ” íŒŒë€ìƒ‰ ë°°ê²½, ë‚˜ë¨¸ì§€ëŠ” íšŒìƒ‰ ë°°ê²½ */
                    selectedCategory === category
                      ? "bg-primary text-white"
                      : "bg-white text-gray-600 hover:bg-gray-100 border border-gray-300"
                  }`}
                >
                  {category}
                </button>
              ))}
            </div>

            {/* ê²€ìƒ‰ ê²°ê³¼ ê°œìˆ˜ */}
            <p className="text-sm text-gray-500 mb-4">
              {filteredBooks.length}ê¶Œì˜ ì±…ì´ ìˆìŠµë‹ˆë‹¤
            </p>

            {/* ì±… ì¹´ë“œ ê·¸ë¦¬ë“œ (ê²©ì ë°°ì—´) */}
            {booksLoading ? (
              <div className="text-center py-16">
                <div className="inline-block w-10 h-10 border-4 border-primary border-t-transparent rounded-full animate-spin"></div>
                <p className="text-gray-500 mt-4">ìƒí’ˆì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
              </div>
            ) : filteredBooks.length > 0 ? (
              <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
                {/*
                  grid: ê²©ì ë ˆì´ì•„ì›ƒ
                  grid-cols-1: ê¸°ë³¸(ëª¨ë°”ì¼) 1ì—´
                  sm:grid-cols-2: 640px ì´ìƒì—ì„œ 2ì—´
                  lg:grid-cols-3: 1024px ì´ìƒì—ì„œ 3ì—´
                  xl:grid-cols-4: 1280px ì´ìƒì—ì„œ 4ì—´
                  gap-6: ì¹´ë“œ ì‚¬ì´ ê°„ê²© 24px
                */}
                {filteredBooks.map((book) => (
                  <div key={book.id} onClick={() => setSelectedBook(book)} className="cursor-pointer">
                    <BookCard book={book} onAddToCart={addToCart} />
                  </div>
                ))}
              </div>
            ) : (
              /* ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ì„ ë•Œ */
              <div className="text-center py-16">
                <svg className="w-16 h-16 mx-auto text-gray-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={1.5} d="M9.172 16.172a4 4 0 015.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                </svg>
                <p className="mt-4 text-gray-500 text-lg">ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤</p>
                <p className="text-gray-400 text-sm mt-1">ë‹¤ë¥¸ ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•´ë³´ì„¸ìš”</p>
              </div>
            )}
          </main>

          {/* ========== í‘¸í„° ========== */}
          <footer className="bg-gray-900 text-gray-400 mt-16">
            <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
              <div className="grid grid-cols-1 md:grid-cols-3 gap-8">
                {/* íšŒì‚¬ ì •ë³´ */}
                <div>
                  <h3 className="text-white font-bold text-lg mb-4">
                    ë¶<span className="text-primary">ìƒµ</span>
                  </h3>
                  <p className="text-sm leading-relaxed">
                    ì¢‹ì€ ì±…ê³¼ ë…ìë¥¼ ì—°ê²°í•˜ëŠ” ì˜¨ë¼ì¸ ì„œì ì…ë‹ˆë‹¤.
                    ë‹¤ì–‘í•œ ë¶„ì•¼ì˜ ì±…ì„ í•©ë¦¬ì ì¸ ê°€ê²©ì— ë§Œë‚˜ë³´ì„¸ìš”.
                  </p>
                </div>
                {/* ê³ ê° ì„œë¹„ìŠ¤ */}
                <div>
                  <h3 className="text-white font-bold mb-4">ê³ ê° ì„œë¹„ìŠ¤</h3>
                  <ul className="space-y-2 text-sm">
                    <li><a href="#" className="hover:text-white transition-colors">ìì£¼ ë¬»ëŠ” ì§ˆë¬¸</a></li>
                    <li><a href="#" className="hover:text-white transition-colors">ë°°ì†¡ ì•ˆë‚´</a></li>
                    <li><a href="#" className="hover:text-white transition-colors">ë°˜í’ˆ/êµí™˜</a></li>
                    <li><a href="#" className="hover:text-white transition-colors">1:1 ë¬¸ì˜</a></li>
                  </ul>
                </div>
                {/* ì—°ë½ì²˜ */}
                <div>
                  <h3 className="text-white font-bold mb-4">ì—°ë½ì²˜</h3>
                  <ul className="space-y-2 text-sm">
                    <li>ì „í™”: 1234-5678</li>
                    <li>ì´ë©”ì¼: help@bookshop.kr</li>
                    <li>ìš´ì˜ì‹œê°„: í‰ì¼ 09:00 - 18:00</li>
                  </ul>
                </div>
              </div>
              {/* ì €ì‘ê¶Œ í‘œì‹œ */}
              <div className="border-t border-gray-800 mt-8 pt-8 text-center text-sm">
                Â© 2026 ë¶ìƒµ. All rights reserved.
              </div>
            </div>
          </footer>

          {/* ========== ì¥ë°”êµ¬ë‹ˆ íŒ¨ë„ (ì—´ë ¤ìˆì„ ë•Œë§Œ í‘œì‹œ) ========== */}
          {isCartOpen && (
            <CartPanel
              cart={cart}
              onClose={() => setIsCartOpen(false)}
              onUpdateQuantity={updateQuantity}
              onRemove={removeFromCart}
              onCheckout={handleCheckout}
            />
          )}

          {/* ========== ì±… ìƒì„¸ ëª¨ë‹¬ (ì±…ì„ í´ë¦­í–ˆì„ ë•Œë§Œ í‘œì‹œ) ========== */}
          {selectedBook && (
            <BookDetail
              book={selectedBook}
              onClose={() => setSelectedBook(null)}
              onAddToCart={addToCart}
            />
          )}

          {/* ========== ë¡œê·¸ì¸ ëª¨ë‹¬ ========== */}
          {showLogin && (
            <LoginModal
              onClose={() => setShowLogin(false)}
              onSwitchToRegister={() => {
                setShowLogin(false);    // ë¡œê·¸ì¸ ëª¨ë‹¬ ë‹«ê³ 
                setShowRegister(true);  // íšŒì›ê°€ì… ëª¨ë‹¬ ì—´ê¸°
              }}
              onLoginSuccess={(userData) => {
                setUser(userData);                          // ì‚¬ìš©ì ì •ë³´ ì €ì¥
                showToast(userData.email + 'ë‹˜ í™˜ì˜í•©ë‹ˆë‹¤!'); // í™˜ì˜ ë©”ì‹œì§€
              }}
            />
          )}

          {/* ========== íšŒì›ê°€ì… ëª¨ë‹¬ ========== */}
          {showRegister && (
            <RegisterModal
              onClose={() => setShowRegister(false)}
              onSwitchToLogin={() => {
                setShowRegister(false); // íšŒì›ê°€ì… ëª¨ë‹¬ ë‹«ê³ 
                setShowLogin(true);     // ë¡œê·¸ì¸ ëª¨ë‹¬ ì—´ê¸°
                showToast('íšŒì›ê°€ì…ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤! ë¡œê·¸ì¸í•´ì£¼ì„¸ìš”.');
              }}
            />
          )}

          {/* ========== í† ìŠ¤íŠ¸ ì•Œë¦¼ (ì¥ë°”êµ¬ë‹ˆ ë‹´ê¸° ì‹œ í‘œì‹œ) ========== */}
          {toast && (
            <div className="fixed bottom-6 left-1/2 -translate-x-1/2 z-50 bg-gray-800 text-white px-6 py-3 rounded-full shadow-lg text-sm font-medium animate-bounce">
              {/* fixed bottom-6: í™”ë©´ í•˜ë‹¨ì— ê³ ì • */}
              {/* left-1/2 -translate-x-1/2: ì •í™•í•œ ê°€ìš´ë° ì •ë ¬ */}
              {toast}
            </div>
          )}
        </div>
      );
    }

    // ============================================
    // ğŸš€ 8ë‹¨ê³„: React ì•± ì‹œì‘!
    // ============================================
    // React 18ì˜ ìƒˆë¡œìš´ ë°©ì‹ìœ¼ë¡œ ì•±ì„ í™”ë©´ì— ë Œë”ë§(ê·¸ë¦¬ê¸°)í•©ë‹ˆë‹¤
    const root = ReactDOM.createRoot(document.getElementById("root"));
    root.render(<App />);
  </script>
</body>
</html>
